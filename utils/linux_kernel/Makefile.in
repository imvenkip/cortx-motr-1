KUTC2_SRCDIR = @SRCDIR@/utils/linux_kernel

obj-m       := kutc2.o
orig_ut     := ../../lib/ut/bitmap.c ../../lib/ut/chan.c ../../lib/ut/thread.c
shared_ut   := $(notdir $(orig_ut))
kutc2-y     := main.o $(shared_ut:.c=.o)

EXTRA_CFLAGS = -DHAVE_CONFIG_H -I@SRCDIR@ @KCFLAGS@

prepare:
	ln -fs $(orig_ut) .

install modules_install:
	$(MAKE) INSTALL_MOD_DIR=kernel/fs/utc2 -C @LINUX_OBJ@ M=`pwd` modules_install

uninstall:
	rm -fr @LINUX_MOD@/kernel/fs/utc2

distclean clean:
	$(RM) $(shared_ut) Module.markers Module.symvers modules.order
	$(MAKE) -C @LINUX_OBJ@ M=`pwd` clean;

distdir:
	cp $(KUTC2_SRCDIR)/Makefile.in $(KUTC2_SRCDIR)/main.c \
@top_builddir@/@PACKAGE@-@VERSION@/utils/linux_kernel
