#! /bin/sh

# Small wrapper to run net-test console, which depends on m0mero module

if [ "$(id -u)" -ne 0 ]; then
    echo "Must be run as root"
    exit 1
fi

# Assign a node uuid for addb.
# See m0t1fs/linux_kernel/m0t1fs.c:m0t1fs_param_node_uuid_get()
NODE_UUID="abcdef01-2345-6789-0123-456789ABCDEF"

. @ABS_SRCDIR@/m0t1fs/linux_kernel/st/common.sh

unload_all() {
    modunload
    modunload_galois
}
trap unload_all EXIT

modprobe_lnet
modload_galois
modload || exit $?

@ABS_SRCDIR@/net/test/user_space/m0nettestd "$@"
