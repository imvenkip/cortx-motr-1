OS=@OS@
KSUNRPC_SRCDIR = @SRCDIR@/net/ksunrpc

ifeq ($(OS),linux)

obj-m := ksunrpc.o
ksunrpc-y = client.o xdr.o

EXTRA_CFLAGS = -DHAVE_CONFIG_H @KCFLAGS@ -O2

all:
	if ! test -e ksunrpc.h; then               \
                ln -s $(KSUNRPC_SRCDIR)/client.c;  \
                ln -s $(KSUNRPC_SRCDIR)/xdr.c;     \
                ln -s $(KSUNRPC_SRCDIR)/ksunrpc.h; \
        fi
	$(MAKE) -C @LINUX_OBJ@ M=`pwd` modules

install modules_install:
	$(MAKE) INSTALL_MOD_DIR=kernel/fs/ksunrpc -C @LINUX_OBJ@ M=`pwd` modules_install

uninstall:
	rm -fr @LUNUX_MOD@/kernel/fs/ksunrpc

distclean clean:
	$(MAKE) -C @LINUX_OBJ@ M=`pwd` clean;
	rm -fr Module.symvers

else

all:
install:
uninstall:
distclean clean:

endif

distdir:
	cp $(KSUNRPC_SRCDIR)/Makefile.in $(KSUNRPC_SRCDIR)/ksunrpc.h $(KSUNRPC_SRCDIR)/xdr.c $(KSUNRPC_SRCDIR)/client.c @top_builddir@/@PACKAGE@-@VERSION@/net/ksunrpc
