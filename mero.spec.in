# optional configure options
%define with_linux %( test -n "$kernel_src" && echo "--with-linux=$kernel_src" )

Name:           @PACKAGE@
Version:        @PACKAGE_VERSION@
# TODO: add kernel version to release string like in lustre
Release:        1@GIT_REV_ID_RPM@%{?dist}
Summary:        Mero filesystem and development libraries
Group:          System Environment/Base
License:        Xyratex
Source:         %{name}-%{version}.tar.gz
BuildArch:      x86_64
ExcludeArch:    i686
# TODO: specify exact lustre-modules version for which we build
Requires:       lustre-modules libyaml genders sysvinit-tools perl perl-YAML-LibYAML perl-DateTime perl-File-Which perl-List-MoreUtils
BuildRequires:  automake autoconf libtool make gcc gcc-c++ gccxml glibc-headers kernel-devel asciidoc libyaml-devel libaio-devel perl perl-XML-LibXML perl-List-MoreUtils perl-File-Find-Rule perl-IO-All lustre-source

%description
Mero filesystem runtime environment and servers.

%prep
%setup -q

%build
%configure %{with_linux} --disable-unit-tests
make %{?_smp_mflags}

%install
rm -rf %{buildroot}
make DESTDIR=%{buildroot} install
find %{buildroot} -name '*.la' -exec rm -f {} ';'

%files
%doc AUTHORS README NEWS ChangeLog COPYING
%{_bindir}/*
%{_sbindir}/*
%{_libdir}/*
%{_sysconfdir}/*
%{_mandir}/*
/lib/modules/*
%exclude %{_includedir}

%post
/sbin/depmod -a

%postun
/sbin/depmod -a

