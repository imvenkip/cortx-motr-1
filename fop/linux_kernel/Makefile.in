OS = @OS@
FOP_SRCDIR = @SRCDIR@/fop/linux_kernel

ifeq ($(OS),linux)

obj-m       := kfop.o
shared_src  := fop.c fop_format.c
kernel_src  := fop_kernel.c
kfop-y      := $(shared_src:.c=.o) $(kernel_src:.c=.o)
orig        := $(shared_src:%=../%)

EXTRA_CFLAGS = -DHAVE_CONFIG_H -I@SRCDIR@ @KCFLAGS@

prepare:
	ln -fs $(orig) .

install modules_install:
	$(MAKE) INSTALL_MOD_DIR=kernel/fs/fop -C @LINUX_OBJ@ M=`pwd` modules_install

uninstall:
	rm -fr @LUNUX_MOD@/kernel/fs/fop

clean distclean:
	$(RM) $(shared_src) Module.markers Module.symvers modules.order
	$(MAKE) -C @LINUX_OBJ@ M=`pwd` clean

else

all:
install:
uninstall:
distclean clean:

endif

distdir:
	cp $(FOP_SRCDIR)/Makefile.in $(FOP_SRCDIR)/fop_kernel.c $(FOP_SRCDIR)/fop_kernel.h \
           @top_builddir@/@PACKAGE@-@VERSION@/fop/linux_kernel
