From 8ff058b04ecc5f0b3d63ff6524e8770897301f4c Mon Sep 17 00:00:00 2001
From: Maxim Medved <Max_Medved@xyratex.com>
Date: Fri, 25 Jan 2013 19:43:39 +0200
Subject: [PATCH 11/79] added description for problem with semaphore max value

---
 net/test/commands.h  | 6 ++++--
 net/test/node.c      | 4 ++++
 net/test/node_ping.c | 3 ++-
 3 files changed, 10 insertions(+), 3 deletions(-)

diff --git a/net/test/commands.h b/net/test/commands.h
index e1e6f00..6a4cbd7 100644
--- a/net/test/commands.h
+++ b/net/test/commands.h
@@ -253,13 +253,15 @@ struct m0_net_test_cmd_ctx {
 	/**
 	   m0_semaphore_up() in message send callback.
 	   m0_semaphore_down() in m0_net_test_commands_send_wait_all().
-	   @todo problem with semaphore max value can be here
+
+	   @note Problem with semaphore max value can be here.
 	 */
 	struct m0_semaphore		   ntcc_sem_send;
 	/**
 	   m0_semaphore_up() in message recv callback.
 	   m0_semaphore_timeddown() in m0_net_test_commands_recv().
-	   @todo problem with semaphore max value can be here
+
+	   @note Problem with semaphore max value can be here.
 	 */
 	struct m0_semaphore		   ntcc_sem_recv;
 	/** Called from message send callback */
diff --git a/net/test/node.c b/net/test/node.c
index dce4330..352474f 100644
--- a/net/test/node.c
+++ b/net/test/node.c
@@ -664,6 +664,10 @@ finished.up();\l", shape=box];
 
    - test buffer for commands between test console and test node have
      size 16KiB now (see ::M0_NET_TEST_CMD_SIZE_MAX);
+   - m0_net_test_cmd_ctx.ntcc_sem_send, m0_net_test_cmd_ctx.ntcc_sem_recv
+     and node_ping_ctx.npc_buf_q_sem can exceed
+     SEMVMX (see 'man 3 sem_post', 'man 2 semop') if large number of
+     network buffers used in the corresponding structures;
 
    <hr>
    @section net-test-ref References
diff --git a/net/test/node_ping.c b/net/test/node_ping.c
index 592843a..3312016 100644
--- a/net/test/node_ping.c
+++ b/net/test/node_ping.c
@@ -184,7 +184,8 @@ struct node_ping_ctx {
 	 * - trydown() before addition to queue. if failed -
 	 *   then don't add to queue;
 	 * - up() after unsuccessful addition to queue.
-	 * @todo problem with semaphore max value can be here
+	 *
+	 * @note Problem with semaphore max value can be here.
 	 */
 	struct m0_semaphore		    npc_buf_q_sem;
 	/** Ringbuf of buffers that are not in network buffers queue */
-- 
1.8.3.2

