From d3cde9b4cab41a689309e8b339e7e9089370d5d6 Mon Sep 17 00:00:00 2001
From: Hua Huang <hua_huang@xyratex.com>
Date: Tue, 9 Apr 2013 18:13:50 +0800
Subject: [PATCH 03/10] remove "-L" option. It is not needed any longer.

---
 ioservice/io_service.c                      |  5 +----
 ioservice/ut/bulkio_common.c                |  7 -------
 m0t1fs/linux_kernel/st/m0t1fs_common_inc.sh |  8 --------
 m0t1fs/linux_kernel/st/m0t1fs_server_inc.sh |  1 -
 mero/setup.c                                | 14 --------------
 mero/setup.h                                |  3 ---
 6 files changed, 1 insertion(+), 37 deletions(-)

diff --git a/ioservice/io_service.c b/ioservice/io_service.c
index 2ed412c..4896a2b 100644
--- a/ioservice/io_service.c
+++ b/ioservice/io_service.c
@@ -606,7 +606,6 @@ M0_INTERNAL int m0_ios_mds_conn_init(struct m0_reqh *reqh,
 {
 	struct m0_mero        *mero;
 	struct m0_rpc_machine *rpc_machine;
-	const char            *cli_ep_addr;
 	const char            *srv_ep_addr;
 	int                    rc;
 	M0_ENTRY();
@@ -618,12 +617,10 @@ M0_INTERNAL int m0_ios_mds_conn_init(struct m0_reqh *reqh,
 	M0_ASSERT(rpc_machine != NULL);
 
 	srv_ep_addr = mero->cc_mds_epx.ex_endpoint;
-	cli_ep_addr = mero->cc_cli2mds_epx.ex_endpoint;
 
-	M0_LOG(M0_DEBUG, "cli = %s", cli_ep_addr);
 	M0_LOG(M0_DEBUG, "srv = %s", srv_ep_addr);
 
-	if (srv_ep_addr == NULL || cli_ep_addr == NULL) {
+	if (srv_ep_addr == NULL) {
 		M0_LOG(M0_WARN, "None of mdservice endpoints provided");
 		M0_RETURN(0);
 	}
diff --git a/ioservice/ut/bulkio_common.c b/ioservice/ut/bulkio_common.c
index 013f53e..644c34d 100644
--- a/ioservice/ut/bulkio_common.c
+++ b/ioservice/ut/bulkio_common.c
@@ -106,16 +106,9 @@ int bulkio_server_start(struct bulkio_params *bp, const char *saddr)
 	strcpy(server_args[18], rpc_size);
 	strcpy(server_args[19], "-w");
 	strcpy(server_args[20], "10");
-#if 0
-	/** @todo FIX ME */
 	strcpy(server_args[21], "-G");
 	strcat(server_args[22], xprt);
 	strcat(server_args[22], saddr);
-	strcpy(server_args[23], "-L");
-	strcat(server_args[24], xprt);
-	strcat(server_args[24], saddr);
-	strcat(server_args[24], "01");
-#endif
 
 	M0_ALLOC_ARR(stypes, IO_SERVER_SERVICE_NR);
 	M0_ASSERT(stypes != NULL);
diff --git a/m0t1fs/linux_kernel/st/m0t1fs_common_inc.sh b/m0t1fs/linux_kernel/st/m0t1fs_common_inc.sh
index 0d2a083..33ae668 100644
--- a/m0t1fs/linux_kernel/st/m0t1fs_common_inc.sh
+++ b/m0t1fs/linux_kernel/st/m0t1fs_common_inc.sh
@@ -58,14 +58,6 @@ EP=(
     12345:33:104
 )
 
-# list of client endpoints to mdservice
-EPC2M=(
-    12345:33:201
-    12345:33:202
-    12345:33:203
-    12345:33:204
-)
-
 SNS_CLI_EP="12345:33:301"
 
 unload_kernel_module()
diff --git a/m0t1fs/linux_kernel/st/m0t1fs_server_inc.sh b/m0t1fs/linux_kernel/st/m0t1fs_server_inc.sh
index 41098b6..b353d3c 100644
--- a/m0t1fs/linux_kernel/st/m0t1fs_server_inc.sh
+++ b/m0t1fs/linux_kernel/st/m0t1fs_server_inc.sh
@@ -35,7 +35,6 @@ mero_service()
 			 -G $XPT:${lnet_nid}:${EP[0]} \
 			 -e $XPT:${lnet_nid}:${EP[$i]} \
 			 $ios_eps \
-			 -L $XPT:${lnet_nid}:${EPC2M[$i]} \
 			 $SNAME -m $MAX_RPC_MSG_SIZE \
 			 -q $TM_MIN_RECV_QUEUE_LEN"
 			echo $cmd
diff --git a/mero/setup.c b/mero/setup.c
index 23b6e57..914a9f5 100644
--- a/mero/setup.c
+++ b/mero/setup.c
@@ -1600,7 +1600,6 @@ static void cs_help(FILE *out)
 "  -C addr  Endpoint address of confd service.\n"
 "  -P str   Configuration profile.\n"
 "  -G addr  Endpoint address of mdservice.\n"
-"  -L addr  Client endpoint address to mdservice.\n"
 "  -i addr  Add new entry to the list of ioservice endpoint addresses.\n"
 "  -f path  Path to genders file, defaults to /etc/mero/genders.\n"
 "  -g       Bootstrap configuration using genders.\n"
@@ -1728,17 +1727,10 @@ static int reqh_ctxs_are_valid(struct m0_mero *cctx)
 		}
 	} m0_tl_endfor;
 
-#if 0
-	/** @todo FIX ME */
 	if (cctx->cc_mds_epx.ex_endpoint == NULL)
 		M0_LOG(M0_WARN, "Missing mdservice endpoint.\n"
 				 "Use -G to provide a valid one");
 
-	if (cctx->cc_cli2mds_epx.ex_endpoint == NULL)
-		M0_LOG(M0_WARN, "Missing client to mdservice endpoint.\n"
-				 "Use -L to provide a valid one");
-#endif
-
 	if (cctx->cc_pool_width <= 0) {
 		M0_LOG(M0_ERROR, "Invalid pool width.\n"
 				 "Use -w to provide a valid integer");
@@ -1861,12 +1853,6 @@ static int _args_parse(struct m0_mero *cctx, int argc, char **argv,
 					rc = ep_and_xprt_extract(&cctx->
 								 cc_mds_epx, s);
 				})),
-			M0_STRINGARG('L',"client endpoint address to mdservice",
-				LAMBDA(void, (const char *s)
-				{
-					rc = ep_and_xprt_extract(&cctx->
-							 cc_cli2mds_epx, s);
-				})),
 			M0_STRINGARG('i', "ioservice endpoints list",
 				LAMBDA(void, (const char *s)
 				{
diff --git a/mero/setup.h b/mero/setup.h
index 0b869ff..f3f2a2c 100644
--- a/mero/setup.h
+++ b/mero/setup.h
@@ -252,9 +252,6 @@ struct m0_mero {
 	/** mdservice endpoint */
 	struct cs_endpoint_and_xprt cc_mds_epx;
 
-	/** client endpoint to mdservice*/
-	struct cs_endpoint_and_xprt cc_cli2mds_epx;
-
 	/** list of ioservice end points */
 	struct m0_tl                cc_ios_eps;
 
-- 
1.8.3.2

