From 51b9a3699370d144e0b30f8aa4043b6c9fb4232f Mon Sep 17 00:00:00 2001
From: Anatoliy Bilenko <anatoliy_bilenko@xyratex.com>
Date: Thu, 30 May 2013 18:09:58 +0300
Subject: [PATCH 066/161] be: added btree to the build system, fix compilation
 errors.

---
 be/Makefile.sub | 2 +-
 be/be.h         | 8 ++++++++
 be/btree.c      | 2 ++
 be/btree.h      | 9 ++++++++-
 be/ut/list.c    | 2 +-
 5 files changed, 20 insertions(+), 3 deletions(-)

diff --git a/be/Makefile.sub b/be/Makefile.sub
index 7ec9bd6..090d254 100644
--- a/be/Makefile.sub
+++ b/be/Makefile.sub
@@ -1,3 +1,3 @@
 nobase_mero_include_HEADERS += be/alloc.h be/list.h be/seg.h
 
-mero_libmero_la_SOURCES += be/alloc.c be/list.c be/seg.c
+mero_libmero_la_SOURCES += be/alloc.c be/list.c be/seg.c be/btree.c
diff --git a/be/be.h b/be/be.h
index a6f2ca4..c259840 100644
--- a/be/be.h
+++ b/be/be.h
@@ -22,6 +22,7 @@
 #ifndef __MERO_BE_BE_H__
 #define __MERO_BE_BE_H__
 
+#include "sm/sm.h"
 #include "be/tx.h"
 
 /**
@@ -30,6 +31,13 @@
  * @{
  */
 
+struct m0_fom;
+struct m0_buf;
+struct m0_be_tx;
+struct m0_be_btree;
+struct m0_be_btree_anchor;
+
+
 struct m0_be {
 	struct m0_be_tx_engine b_tx;
 	struct m0_be_seg       b_seg0;
diff --git a/be/btree.c b/be/btree.c
index 8538198..472ce53 100644
--- a/be/btree.c
+++ b/be/btree.c
@@ -24,6 +24,8 @@
  * @{
  */
 
+#include "be/btree.h"
+
 /** @} end of be group */
 
 /*
diff --git a/be/btree.h b/be/btree.h
index 0440b63..09cda3b 100644
--- a/be/btree.h
+++ b/be/btree.h
@@ -28,6 +28,14 @@
  * @{
  */
 
+#include "lib/rwlock.h"
+#include "lib/buf.h"
+#include "be/seg.h"
+#include "be/be.h"
+
+struct m0_be_tx;
+struct m0_be_tx_credit;
+
 struct m0_be_btree {
 	struct m0_rwlock    bb_lock;
 	struct m0_be_seg   *bb_seg;
@@ -56,7 +64,6 @@ M0_INTERNAL void m0_be_btree_destroy(struct m0_be_btree *tree,
 struct m0_be_btree_cursor {
 	struct m0_be_btree *bc_tree;
 	struct m0_be_op     bc_op;
-	struct m0_buf       bc_current;
 };
 
 M0_INTERNAL void m0_be_btree_cursor_init(struct m0_be_btree_cursor *cursor,
diff --git a/be/ut/list.c b/be/ut/list.c
index 9e2ee6e..0979b1f 100644
--- a/be/ut/list.c
+++ b/be/ut/list.c
@@ -19,7 +19,7 @@
 
 #include "ut/ut.h"
 
-static test_XXX(void)
+static void test_XXX(void)
 {
 }
 
-- 
1.8.3.2

