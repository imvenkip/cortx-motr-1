From 04c7bdda8e2ce622ee55d1b8f2c3ab89ca78227a Mon Sep 17 00:00:00 2001
From: Hua Huang <hua_huang@xyratex.com>
Date: Fri, 3 May 2013 11:12:59 +0800
Subject: [PATCH 06/14] add new files and make pass.

---
 pool/Kbuild.sub   |  2 +-
 pool/Makefile.sub | 13 +++++++++++--
 pool/pool.h       |  7 ++++---
 pool/pool_fops.c  | 47 ++++++++++++++++++++++++++++++++++++++++++++++
 pool/pool_fops.h  | 56 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 pool/pool_store.c |  6 +++---
 6 files changed, 122 insertions(+), 9 deletions(-)
 create mode 100644 pool/pool_fops.c
 create mode 100644 pool/pool_fops.h

diff --git a/pool/Kbuild.sub b/pool/Kbuild.sub
index 03ffffe..7f5ef91 100644
--- a/pool/Kbuild.sub
+++ b/pool/Kbuild.sub
@@ -1 +1 @@
-m0mero_objects += pool/pool.o
+m0mero_objects += pool/pool.o pool/pool_store.o pool/pool_fops.o
diff --git a/pool/Makefile.sub b/pool/Makefile.sub
index ef94b45..70e32bf 100644
--- a/pool/Makefile.sub
+++ b/pool/Makefile.sub
@@ -1,3 +1,12 @@
-nobase_mero_include_HEADERS += pool/pool.h
+nobase_mero_include_HEADERS += pool/pool.h \
+			       pool/pool_fops.h
+
 mero_libmero_la_SOURCES  += pool/pool.c \
-			    pool/pool_store.c
+			    pool/pool_store.c \
+			    pool/pool_fops.c
+
+XC_FILES   += pool/pool_fops_xc.h
+
+CLEANFILES += pool/pool_fops_xc.h \
+              pool/pool_fops_xc.c \
+              pool/pool_fops.gccxml
diff --git a/pool/pool.h b/pool/pool.h
index 3a2fec0..5a5f828 100644
--- a/pool/pool.h
+++ b/pool/pool.h
@@ -20,8 +20,8 @@
 
 #pragma once
 
-#ifndef __MERO_LAYOUT_POOL_H__
-#define __MERO_LAYOUT_POOL_H__
+#ifndef __MERO_POOL_POOL_H__
+#define __MERO_POOL_POOL_H__
 
 #include "lib/cdefs.h"
 #include "lib/rwlock.h"
@@ -507,10 +507,11 @@ M0_INTERNAL void m0_poolmach_event_dump(struct m0_pool_event *e);
 M0_INTERNAL void m0_poolmach_event_list_dump(struct m0_poolmach *pm);
 M0_INTERNAL void m0_poolmach_device_state_dump(struct m0_poolmach *pm);
 
+
 /** @} end of servermachine group */
 
 
-/* __MERO_LAYOUT_POOL_H__ */
+/* __MERO_POOL_POOL_H__ */
 #endif
 
 /*
diff --git a/pool/pool_fops.c b/pool/pool_fops.c
new file mode 100644
index 0000000..48c25be
--- /dev/null
+++ b/pool/pool_fops.c
@@ -0,0 +1,47 @@
+/* -*- C -*- */
+/*
+ * COPYRIGHT 2013 XYRATEX TECHNOLOGY LIMITED
+ *
+ * THIS DRAWING/DOCUMENT, ITS SPECIFICATIONS, AND THE DATA CONTAINED
+ * HEREIN, ARE THE EXCLUSIVE PROPERTY OF XYRATEX TECHNOLOGY
+ * LIMITED, ISSUED IN STRICT CONFIDENCE AND SHALL NOT, WITHOUT
+ * THE PRIOR WRITTEN PERMISSION OF XYRATEX TECHNOLOGY LIMITED,
+ * BE REPRODUCED, COPIED, OR DISCLOSED TO A THIRD PARTY, OR
+ * USED FOR ANY PURPOSE WHATSOEVER, OR STORED IN A RETRIEVAL SYSTEM
+ * EXCEPT AS ALLOWED BY THE TERMS OF XYRATEX LICENSES AND AGREEMENTS.
+ *
+ * YOU SHOULD HAVE RECEIVED A COPY OF XYRATEX'S LICENSE ALONG WITH
+ * THIS RELEASE. IF NOT PLEASE CONTACT A XYRATEX REPRESENTATIVE
+ * http://www.xyratex.com/contact
+ *
+ * Original author: Huang Hua <Hua_Huang@xyratex.com>
+ * Original creation date: 05/03/2013
+ */
+
+#undef M0_TRACE_SUBSYSTEM
+#define M0_TRACE_SUBSYSTEM M0_TRACE_SUBSYS_POOL
+#include "lib/trace.h"      /* M0_LOG */
+#include "lib/errno.h"
+#include "lib/memory.h"
+#include "pool/pool.h"
+#include "lib/misc.h"
+
+/**
+   @addtogroup pool
+
+   @{
+ */
+
+
+#undef M0_TRACE_SUBSYSTEM
+/** @} end group pool */
+
+/*
+ *  Local variables:
+ *  c-indentation-style: "K&R"
+ *  c-basic-offset: 8
+ *  tab-width: 8
+ *  fill-column: 80
+ *  scroll-step: 1
+ *  End:
+ */
diff --git a/pool/pool_fops.h b/pool/pool_fops.h
new file mode 100644
index 0000000..9cb92e7
--- /dev/null
+++ b/pool/pool_fops.h
@@ -0,0 +1,56 @@
+/* -*- C -*- */
+/*
+ * COPYRIGHT 2013 XYRATEX TECHNOLOGY LIMITED
+ *
+ * THIS DRAWING/DOCUMENT, ITS SPECIFICATIONS, AND THE DATA CONTAINED
+ * HEREIN, ARE THE EXCLUSIVE PROPERTY OF XYRATEX TECHNOLOGY
+ * LIMITED, ISSUED IN STRICT CONFIDENCE AND SHALL NOT, WITHOUT
+ * THE PRIOR WRITTEN PERMISSION OF XYRATEX TECHNOLOGY LIMITED,
+ * BE REPRODUCED, COPIED, OR DISCLOSED TO A THIRD PARTY, OR
+ * USED FOR ANY PURPOSE WHATSOEVER, OR STORED IN A RETRIEVAL SYSTEM
+ * EXCEPT AS ALLOWED BY THE TERMS OF XYRATEX LICENSES AND AGREEMENTS.
+ *
+ * YOU SHOULD HAVE RECEIVED A COPY OF XYRATEX'S LICENSE ALONG WITH
+ * THIS RELEASE. IF NOT PLEASE CONTACT A XYRATEX REPRESENTATIVE
+ * http://www.xyratex.com/contact
+ *
+ * Original author: Huang Hua <Hua_Huang@xyratex.com>
+ * Original creation date: 05/03/2013
+ */
+
+#pragma once
+
+#ifndef __MERO_POOL_POOL_FOPS_H__
+#define __MERO_POOL_POOL_FOPS_H__
+
+#include "ioservice/io_fops.h"
+#include "ioservice/io_fops_xc.h"
+
+struct m0_poolmach_update_fop_req {
+	/** replica's cached version. */
+        struct m0_fv_version pu_fv_version;
+} M0_XCA_RECORD;
+
+struct m0_poolmach_update_fop_rep {
+	uint32_t            pu_rc;
+
+	/** latest version number. */
+        struct m0_fv_version pu_fv_version;
+
+	/** events list */
+        struct m0_fv_updates pu_fv_updates;
+} M0_XCA_RECORD;
+
+
+/* __MERO_POOL_POOL_FOPS_H__ */
+#endif
+
+/*
+ *  Local variables:
+ *  c-indentation-style: "K&R"
+ *  c-basic-offset: 8
+ *  tab-width: 8
+ *  fill-column: 80
+ *  scroll-step: 1
+ *  End:
+ */
diff --git a/pool/pool_store.c b/pool/pool_store.c
index 90b276c..774eee0 100644
--- a/pool/pool_store.c
+++ b/pool/pool_store.c
@@ -1,5 +1,5 @@
 /*
- * COPYRIGHT 2011 XYRATEX TECHNOLOGY LIMITED
+ * COPYRIGHT 2013 XYRATEX TECHNOLOGY LIMITED
  *
  * THIS DRAWING/DOCUMENT, ITS SPECIFICATIONS, AND THE DATA CONTAINED
  * HEREIN, ARE THE EXCLUSIVE PROPERTY OF XYRATEX TECHNOLOGY
@@ -13,8 +13,8 @@
  * THIS RELEASE. IF NOT PLEASE CONTACT A XYRATEX REPRESENTATIVE
  * http://www.xyratex.com/contact
  *
- * Original author: Nikita Danilov <Nikita_Danilov@xyratex.com>
- * Original creation date: 07/15/2010
+ * Original author: Huang Hua <Hua_Huang@xyratex.com>
+ * Original creation date: 05/03/2013
  */
 
 #undef M0_TRACE_SUBSYSTEM
-- 
1.8.3.2

