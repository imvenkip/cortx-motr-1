From a8188fd5310e2088ecab510e517b21c0690572e5 Mon Sep 17 00:00:00 2001
From: Rajanikant Chirmade <rajanikant_chirmade@xyratex.com>
Date: Fri, 15 Nov 2013 18:45:34 +0530
Subject: [PATCH 156/159]  - Some of review comments.

---
 addb/addb_rec.c |  1 -
 fop/fom.c       | 11 +----------
 reqh/reqh.c     |  7 -------
 3 files changed, 1 insertion(+), 18 deletions(-)

diff --git a/addb/addb_rec.c b/addb/addb_rec.c
index d70653d..10fdbea 100644
--- a/addb/addb_rec.c
+++ b/addb/addb_rec.c
@@ -169,7 +169,6 @@ static void addb_rec_post(struct m0_addb_mc *mc,
 		} m0_tl_endfor;
 		m0_mutex_unlock(&mc->am_reqh->rh_addb_monitoring_ctx.amc_mutex);
 	}
-#undef MON_CTX_CONFIGURED
 }
 
 #ifndef __KERNEL__
diff --git a/fop/fom.c b/fop/fom.c
index 0de663e..69319d9 100644
--- a/fop/fom.c
+++ b/fop/fom.c
@@ -287,13 +287,13 @@ static void fop_rate_monitor_fini(struct m0_reqh         *reqh,
 
 	M0_PRE(monitor != NULL && reqh != NULL);
 
-	sum_rec = monitor->am_ops->amo_sum_rec(monitor, reqh);
 	m0_addb_monitor_del(reqh, monitor);
 
 	m0_rwlock_write_lock(&reqh->rh_rwlock);
 	m0_reqh_lockers_clear(reqh, fop_rate_monitor_key);
 	m0_rwlock_write_unlock(&reqh->rh_rwlock);
 
+	sum_rec = monitor->am_ops->amo_sum_rec(monitor, reqh);
 	m0_addb_monitor_sum_rec_fini(sum_rec);
 	m0_free(sum_rec);
 
@@ -942,15 +942,6 @@ static int loc_init(struct m0_fom_locality *loc, size_t cpu, size_t cpu_max)
 	if (result != 0)
 		goto err1;
 
-	result = m0_addb_counter_init(&loc->fl_stat_fop_rate,
-				      &m0_addb_rt_fop_rate_cntr);
-	if (result != 0) {
-		m0_addb_counter_fini(&loc->fl_stat_sched_wait_times);
-		m0_addb_counter_fini(&loc->fl_stat_run_times);
-		m0_addb_ctx_fini(&loc->fl_addb_ctx);
-		return result;
-	}
-
 	runq_tlist_init(&loc->fl_runq);
 	loc->fl_runq_nr = 0;
 
diff --git a/reqh/reqh.c b/reqh/reqh.c
index 072de85..52a6217 100644
--- a/reqh/reqh.c
+++ b/reqh/reqh.c
@@ -198,13 +198,6 @@ monitors_init_failed:
 	m0_addb_mc_fini(&reqh->rh_addb_mc);
 	m0_ha_domain_fini(&reqh->rh_hadom);
 	return rc;
-
-fom_domain_init_failed:
-	m0_addb_monitors_fini(reqh);
-monitors_init_failed:
-	m0_rwlock_fini(&reqh->rh_rwlock);
-	m0_reqh_lockers_fini(reqh);
-	return rc;
 }
 
 #ifndef __KERNEL__
-- 
1.8.3.2

