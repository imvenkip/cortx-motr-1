From 928d41fa274fab9fabba622044161bdbc3a5bd81 Mon Sep 17 00:00:00 2001
From: Maxim Medved <max_medved@xyratex.com>
Date: Wed, 20 Nov 2013 02:09:45 +0200
Subject: [PATCH 20/26] be/allocator: don't memset() entire chunk memory: it
 may be larger than requested

---
 be/alloc.c | 5 ++---
 1 file changed, 2 insertions(+), 3 deletions(-)

diff --git a/be/alloc.c b/be/alloc.c
index d6ed09d..eec6c8a 100644
--- a/be/alloc.c
+++ b/be/alloc.c
@@ -774,9 +774,8 @@ M0_INTERNAL void m0_be_alloc_aligned(struct m0_be_allocator *a,
 			break;
 	} m0_tl_endfor;
 	if (c != NULL && tx != NULL) {
-		memset(&c->bac_mem, 0, c->bac_size);
-		m0_be_tx_capture(tx, &M0_BE_REG(a->ba_seg,
-						c->bac_size, &c->bac_mem));
+		memset(&c->bac_mem, 0, size);
+		m0_be_tx_capture(tx, &M0_BE_REG(a->ba_seg, size, &c->bac_mem));
 	}
 	op->bo_u.u_allocator.a_ptr = c == NULL ?    NULL : &c->bac_mem;
 	op->bo_u.u_allocator.a_rc  = c == NULL ? -ENOMEM : 0;
-- 
1.8.3.2

