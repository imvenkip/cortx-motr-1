From 4cd004114b596151f4583006b2d6bb7978e96cf7 Mon Sep 17 00:00:00 2001
From: Maxim Medved <max_medved@xyratex.com>
Date: Thu, 12 Dec 2013 05:28:29 +0200
Subject: [PATCH 26/26] be/allocator: added workaround for credit bugs

---
 be/alloc.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/be/alloc.c b/be/alloc.c
index 7ad7a12..6f89cf2 100644
--- a/be/alloc.c
+++ b/be/alloc.c
@@ -752,6 +752,9 @@ M0_INTERNAL void m0_be_allocator_credit(struct m0_be_allocator *a,
 		default:
 			M0_IMPOSSIBLE("Invalid allocator operation type");
 	}
+	/* XXX FIXME ASAP workaround for allocator/btree/etc. credit bugs */
+	/* 640 bytes ought to be enough for anybody */
+	m0_be_tx_credit_add(accum, &M0_BE_TX_CREDIT(40, 640));
 }
 
 M0_INTERNAL void m0_be_alloc_aligned(struct m0_be_allocator *a,
-- 
1.8.3.2

