From fc60e3567323fca2d887a343f3aa060337f82921 Mon Sep 17 00:00:00 2001
From: Maxim Medved <max_medved@xyratex.com>
Date: Wed, 27 Nov 2013 23:47:39 +0200
Subject: [PATCH 06/13] scripts/be_allocator: don't hardcode libmero.so path

---
 scripts/be_allocator.sh  | 7 ++++---
 scripts/be_allocator.stp | 8 ++++----
 2 files changed, 8 insertions(+), 7 deletions(-)

diff --git a/scripts/be_allocator.sh b/scripts/be_allocator.sh
index ba36870..419bd5a 100755
--- a/scripts/be_allocator.sh
+++ b/scripts/be_allocator.sh
@@ -1,6 +1,7 @@
 #!/bin/bash
 
-# BINARY="$1"
-BINARY="utils/.libs/lt-ut"
+CWD=$(cd "$( dirname "$0")" && pwd)
+
+BINARY="${1-$CWD/../mero/.libs/libmero-0.1.0.so}"
 stap -vv -d "$BINARY" --ldd -DMAXTRACE=10 -DSTP_NO_OVERLOAD -DMAXSKIPPED=1000000 -DMAXERRORS=1000 \
-    ./scripts/be_allocator.stp "$BINARY" 0 0
+    ./scripts/be_allocator.stp "$BINARY"
diff --git a/scripts/be_allocator.stp b/scripts/be_allocator.stp
index 6cd2d28..1245aea 100644
--- a/scripts/be_allocator.stp
+++ b/scripts/be_allocator.stp
@@ -3,14 +3,14 @@
 global func_time
 global func_time_avg
 
-probe	process("/work/mero/mero/.libs/libmero-0.1.0.so").function("m0_be_alloc_aligned"),
-	process("/work/mero/mero/.libs/libmero-0.1.0.so").function("m0_be_free_aligned")
+probe	process(@1).function("m0_be_alloc_aligned"),
+	process(@1).function("m0_be_free_aligned")
 {
 	func_time[tid(), ppfunc()] = gettimeofday_ns()
 }
 
-probe	process("/work/mero/mero/.libs/libmero-0.1.0.so").function("m0_be_alloc_aligned").return,
-	process("/work/mero/mero/.libs/libmero-0.1.0.so").function("m0_be_free_aligned").return
+probe	process(@1).function("m0_be_alloc_aligned").return,
+	process(@1).function("m0_be_free_aligned").return
 {
 	time_elapsed = gettimeofday_ns() - func_time[tid(), ppfunc()]
 	delete func_time[tid(), ppfunc()]
-- 
1.8.3.2

