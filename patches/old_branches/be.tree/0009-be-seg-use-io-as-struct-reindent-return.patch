From 29257675c0eb2ce0df3223192abac1e7de9cab9b Mon Sep 17 00:00:00 2001
From: Alexander Gattin <alexander_gattin@xyratex.com>
Date: Fri, 24 May 2013 15:17:53 +0300
Subject: [PATCH 009/290] be/seg: use io as struct, reindent, return

---
 be/seg.c | 14 +++++++++-----
 1 file changed, 9 insertions(+), 5 deletions(-)

diff --git a/be/seg.c b/be/seg.c
index 86f2206..ea22f16 100644
--- a/be/seg.c
+++ b/be/seg.c
@@ -62,22 +62,26 @@ int m0_be_seg_open(struct m0_be_seg *seg);
 	/* XXX: need to declare buffers/vectors etc for STOBIO */
 	m0_bcount_t       rdvec[1];
 
-       	st_block_shift = seg->bs_stob->so_op->sop_block_shift(seg->bs_stob);
+	st_block_shift = seg->bs_stob->so_op->sop_block_shift(seg->bs_stob);
 	m0_stob_io_init(&io);
 	/* TODO: prepare buffer for stob IO, align etc */
-	io->si_flags  = 0;
-	io->si_opcode = SIO_READ;
-	io->si_user.ov_buf = (void **) buf;
+	io.si_flags  = 0;
+	io.si_opcode = SIO_READ;
+	/* io.si_user.ov_buf = ;*/
 
 	m0_clink_init(&clink, NULL);
 	m0_clink_add_lock(&io.si_wait, &clink);
 	r = m0_stob_io_launch(&io, seg->bs_stob, NULL, NULL);
-	m0_chan_wait(&clink);
+	if (r == 0) {
+		m0_chan_wait(&clink);
+	};
 	m0_clink_del_lock(&clink);
 	m0_clink_fini(&clink);
 	m0_stob_io_fini(&io);
+	if (r != 0) return r;
 
 	/* TODO: mmap an area at bh_addr of bh_size */
+	return 0;
 }
 
 void m0_be_reg_get(struct m0_be_reg *reg, struct m0_be_op *op)
-- 
1.8.3.2

