From 6d5d7e6494fe4123855a5bf9c80afd4ee6011a75 Mon Sep 17 00:00:00 2001
From: "Valery V. Vorotyntsev" <valery_vorotyntsev@xyratex.com>
Date: Wed, 26 Jun 2013 17:28:56 +0300
Subject: [PATCH 237/290] be: delete temporary macro from tx_fom.c

---
 be/tx_fom.c | 44 +++-----------------------------------------
 1 file changed, 3 insertions(+), 41 deletions(-)

diff --git a/be/tx_fom.c b/be/tx_fom.c
index 8df35ad..6cdf976 100644
--- a/be/tx_fom.c
+++ b/be/tx_fom.c
@@ -30,28 +30,6 @@
 #include "reqh/reqh.h"      /* m0_reqh_state_get */
 #include "lib/errno.h"      /* ENOMEM */
 
-#define XXX_MOCK_IO 0
-#if XXX_MOCK_IO /* XXX <<<<<<< */
-#  include "lib/thread.h"
-#  include "lib/mutex.h"
-#  include "lib/chan.h"
-#  include <unistd.h>
-
-static struct m0_thread g_thread;
-static struct m0_chan   g_chan;
-static struct m0_mutex  g_mutex;
-
-static void g_handler(int ignore)
-{
-	M0_LOG(M0_DEBUG, "io emulation started");
-	sleep(3);
-	m0_mutex_lock(&g_mutex);
-	m0_chan_signal(&g_chan);
-	m0_mutex_unlock(&g_mutex);
-	M0_LOG(M0_DEBUG, "io emulation ended");
-}
-#endif /* XXX >>>>>>> */
-
 /**
  * @addtogroup be
  * @{
@@ -156,25 +134,12 @@ static int tx_fom_tick(struct m0_fom *fom)
 		break;
 
 	case FS_SUBMITTED_TO_SEG:
-#if XXX_MOCK_IO
-		m0_mutex_init(&g_mutex);
-		m0_chan_init(&g_chan, &g_mutex);
-
-		M0_THREAD_INIT(&g_thread, int, NULL, &g_handler, 0, "XXX");
-
-		m0_mutex_lock(&g_mutex);
-		m0_fom_wait_on(fom, &g_chan, &fom->fo_cb);
-		m0_mutex_unlock(&g_mutex);
-
-		m0_fom_phase_set(fom, FS_PLACED);
-		return M0_FSO_WAIT;
-#else
 		{
-			struct tx_fom	      *f = fom_to_txm(fom);
+			struct tx_fom         *f = fom_to_txm(fom);
 			struct m0_be_reg_area *area = &tx->t_reg_area;
 			struct m0_be_seg      *seg;
-			struct m0_be_op	      *op = &f->tf_op;
-			size_t		       size;
+			struct m0_be_op       *op = &f->tf_op;
+			size_t                 size;
 
 			size = m0_be_regmap_size(&area->bra_map);
 			M0_ASSERT(size > 0);
@@ -185,13 +150,10 @@ static int tx_fom_tick(struct m0_fom *fom)
 
 			return m0_be_op_tick_ret(op, fom, FS_PLACED);
 		}
-#endif
 	case FS_PLACED:
-#if !XXX_MOCK_IO
 		M0_ASSERT(m0_be_op_state(&fom_to_txm(fom)->tf_op) ==
 			  M0_BOS_SUCCESS);
 		m0_be_op_fini(&fom_to_txm(fom)->tf_op);
-#endif
 		tx_state_set(tx, M0_BTS_PLACED);
 		m0_be_tx_free(tx);  /* free region buffers */
 		m0_fom_phase_set(fom, FS_STABLE);
-- 
1.8.3.2

