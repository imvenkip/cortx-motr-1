From 291d3a1f5296252d761408fcfe003fcf6658d262 Mon Sep 17 00:00:00 2001
From: "Valery V. Vorotyntsev" <valery_vorotyntsev@xyratex.com>
Date: Tue, 2 Jul 2013 15:42:43 +0300
Subject: [PATCH 259/290] be: add *_st_in() placeholders to be/tx_fom.c

---
 be/tx.c     | 22 +++++++++++-----------
 be/tx_fom.c | 26 ++++++++++++++++++--------
 2 files changed, 29 insertions(+), 19 deletions(-)

diff --git a/be/tx.c b/be/tx.c
index b196c37..fe43b32 100644
--- a/be/tx.c
+++ b/be/tx.c
@@ -566,19 +566,19 @@ m0_be__tx_state_post(struct m0_be_tx *tx, enum m0_be_tx_state state)
 	 *
 	 *             locality
 	 *             --------
-	 *             sm_group    sm_group    sm_group
-	 *                | |           |         | |
-	 *                | |           |         | |
-	 *      tx_group  | |           |         | |
-	 *      --------  | |           |         | |
-	 *           fom -' |           |         | |
-	 *                  |  tx   tx  |     tx  | |  tx
-	 *                  |  --   --  |     --  | |  --
-	 *                  `- sm   sm -'     sm -' `- sm
+	 *             sm_group     sm_group    sm_group
+	 *                | |            |         | |
+	 *                | |            |         | |
+	 *      tx_group  | |            |         | |
+	 *      --------  | |            |         | |
+	 *           fom -' |            |         | |
+	 *                  |  tx    tx  |     tx  | |  tx
+	 *                  |  --    --  |     --  | |  --
+	 *                  `- sm    sm -'     sm -' `- sm
 	 *
-	 * ->fo_tick() of tx_group's fom may not assume that sm_group of
+	 * ->fo_tick() of tx_group's fom shall not assume that sm_group of
 	 * tx's sm is locked. In order to advance tx's sm, ->fo_tick()
-	 * implementation posts an AST to tx's sm_group.
+	 * implementation should post an AST to tx's sm_group.
 	 */
 	M0_ENTRY("state=%u", state);
 	M0_PRE(M0_IN(state, (M0_BTS_SUBMITTED, M0_BTS_LOGGED, M0_BTS_PLACED,
diff --git a/be/tx_fom.c b/be/tx_fom.c
index a55fe24..b86fb0d 100644
--- a/be/tx_fom.c
+++ b/be/tx_fom.c
@@ -282,22 +282,32 @@ static struct tx_group_fom *tx_group_fom(const struct m0_fom *fom)
  * State transitions
  * ------------------------------------------------------------------ */
 
-static int group_closed_st_in(struct m0_sm *mach)
+static int open_st_in(struct m0_sm *mach)
 {
-	M0_LOG(M0_DEBUG, "Entering sm_state %u", mach->sm_state);
+	M0_ENTRY();
+	M0_LEAVE();
+	return -1;
+}
+
+static int logging_st_in(struct m0_sm *mach)
+{
+	M0_ENTRY();
+	M0_LEAVE();
 	return -1;
 }
 
-static void group_closed_st_ex(struct m0_sm *mach)
+static int committing_st_in(struct m0_sm *mach)
 {
-	M0_LOG(M0_DEBUG, "Leaving sm_state %u", mach->sm_state);
+	M0_ENTRY();
+	M0_LEAVE();
+	return -1;
 }
 
-static bool group_closed_st_invariant(const struct m0_sm *mach)
+static int placing_st_in(struct m0_sm *mach)
 {
-	/* XXX DELETEME */
-	return tx_group_fom(sm_to_fom(mach))->tf_engine->te_fom ==
-		sm_to_fom(mach);
+	M0_ENTRY();
+	M0_LEAVE();
+	return -1;
 }
 
 /** @} end of be group */
-- 
1.8.3.2

