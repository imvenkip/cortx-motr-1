From 3ba26b3a39453282a46977ed60d203ad16dd2ec3 Mon Sep 17 00:00:00 2001
From: "Valery V. Vorotyntsev" <valery_vorotyntsev@xyratex.com>
Date: Thu, 27 Jun 2013 00:09:17 +0300
Subject: [PATCH 241/290] be: revise M0_BE_TX_CAPTURE_PTR() definition

+ Fix grammar in a comment.
---
 be/tx.c | 5 +++--
 be/tx.h | 8 +++-----
 2 files changed, 6 insertions(+), 7 deletions(-)

diff --git a/be/tx.c b/be/tx.c
index 2fe5991..b1c8de9 100644
--- a/be/tx.c
+++ b/be/tx.c
@@ -452,8 +452,9 @@ M0_INTERNAL void m0_be_tx_close(struct m0_be_tx *tx)
 
 	M0_ASSERT(used <= prepared);
 	M0_ASSERT(eng->te_reserved + used >= prepared);
-
-	/* release prepared, but not not used space back into the log. */
+	/*
+	 * Release excessive (prepared, but not used) space back into the log.
+	 */
 	eng->te_reserved -= prepared - used;
 
 	tx_engine_got_space(eng);
diff --git a/be/tx.h b/be/tx.h
index 88a3284..d74819d 100644
--- a/be/tx.h
+++ b/be/tx.h
@@ -408,11 +408,6 @@ struct m0_be_tx {
 	void                  *t_datum;
 };
 
-#define M0_BE_TX_CAPTURE_PTR(seg, tx, ptr)				\
-({									\
-	m0_be_tx_capture(tx, &M0_BE_REG((seg), sizeof *(ptr), (ptr)));	\
-})
-
 M0_INTERNAL bool m0_be__tx_invariant(const struct m0_be_tx *tx);
 
 M0_INTERNAL void m0_be_tx_init(struct m0_be_tx *tx, uint64_t tid,
@@ -442,6 +437,9 @@ M0_INTERNAL void m0_be_tx_capture(struct m0_be_tx *tx,
 M0_INTERNAL void m0_be_tx_uncapture(struct m0_be_tx *tx,
 				    const struct m0_be_reg *reg);
 
+#define M0_BE_TX_CAPTURE_PTR(seg, tx, ptr) \
+	m0_be_tx_capture((tx), &M0_BE_REG((seg), sizeof *(ptr), (ptr)))
+
 M0_INTERNAL void m0_be_tx_close(struct m0_be_tx *tx);
 
 M0_INTERNAL int m0_be_tx_timedwait(struct m0_be_tx *tx, int state,
-- 
1.8.3.2

