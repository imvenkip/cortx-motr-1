From 81027d08d5e13722030775dd97b649093b96ae06 Mon Sep 17 00:00:00 2001
From: Maxim Medved <Max_Medved@xyratex.com>
Date: Sun, 13 Jan 2013 05:30:54 +0200
Subject: [PATCH 64/71] used strchr() instead of for(...) in
 c2_net_test_slist_init()

---
 net/test/slist.c | 32 +++++++++++++++++---------------
 1 file changed, 17 insertions(+), 15 deletions(-)

diff --git a/net/test/slist.c b/net/test/slist.c
index d545879..a4b0430 100644
--- a/net/test/slist.c
+++ b/net/test/slist.c
@@ -56,10 +56,11 @@ int c2_net_test_slist_init(struct c2_net_test_slist *slist,
 			   const char *str,
 			   char delim)
 {
-	char  *str1;
-	size_t len = 0;
-	size_t i = 0;
-	bool   allocated;
+	const char *str1;
+	char	   *str2;
+	size_t	    len = 0;
+	size_t	    i = 0;
+	bool	    allocated;
 
 	C2_PRE(slist != NULL);
 	C2_PRE(str   != NULL);
@@ -67,24 +68,25 @@ int c2_net_test_slist_init(struct c2_net_test_slist *slist,
 
 	C2_SET0(slist);
 
-	for (len = 0; str[len] != '\0'; ++len)
-		slist->ntsl_nr += str[len] == delim;
-
+	len = strlen(str);
 	if (len != 0) {
-		slist->ntsl_nr++;
-
+		for (str1 = str; str1 != NULL; str1 = strchr(str1, delim)) {
+			++str1;
+			++slist->ntsl_nr;
+		}
 		allocated = slist_alloc(slist, slist->ntsl_nr, len + 1);
 		if (!allocated)
 			return -ENOMEM;
 
 		strncpy(slist->ntsl_str, str, len + 1);
-		str1 = slist->ntsl_str;
-		slist->ntsl_list[i++] = str1;
-		for (; *str1 != '\0'; ++str1)
-			if (*str1 == delim) {
-				*str1 = '\0';
-				slist->ntsl_list[i++] = str1 + 1;
+		str2 = slist->ntsl_str;
+		for ( ; str2 != NULL; str2 = strchr(str2, delim)) {
+			if (str2 != slist->ntsl_str) {
+				*str2 = '\0';
+				++str2;
 			}
+			slist->ntsl_list[i++] = str2;
+		}
 	}
 	C2_POST(c2_net_test_slist_invariant(slist));
 	return 0;
-- 
1.8.3.2

