From c77fc6830bd36da7c37d7105ae193d13d9baa5c1 Mon Sep 17 00:00:00 2001
From: "Valery V. Vorotyntsev" <valery_vorotyntsev@xyratex.com>
Date: Fri, 12 Jul 2013 23:58:35 +0300
Subject: [PATCH 08/14] net: refactor m0_net__tm_event_invariant()

---
 net/tm.c | 19 ++++++-------------
 1 file changed, 6 insertions(+), 13 deletions(-)

diff --git a/net/tm.c b/net/tm.c
index ef63d05..f8c57dd 100644
--- a/net/tm.c
+++ b/net/tm.c
@@ -57,19 +57,12 @@ M0_INTERNAL bool m0_net__tm_ev_type_is_valid(enum m0_net_tm_ev_type et)
 
 M0_INTERNAL bool m0_net__tm_event_invariant(const struct m0_net_tm_event *ev)
 {
-	if (!m0_net__tm_ev_type_is_valid(ev->nte_type))
-		return false;
-	if (ev->nte_tm == NULL ||
-	    !m0_net__tm_invariant(ev->nte_tm))
-		return false;
-	if (ev->nte_type == M0_NET_TEV_STATE_CHANGE &&
-	    !m0_net__tm_state_is_valid(ev->nte_next_state))
-		return false;
-	if (ev->nte_type == M0_NET_TEV_STATE_CHANGE &&
-	    ev->nte_next_state == M0_NET_TM_STARTED &&
-	    !m0_net__ep_invariant(ev->nte_ep, ev->nte_tm, true))
-		return false;
-	return true;
+	return  m0_net__tm_ev_type_is_valid(ev->nte_type) &&
+		m0_net__tm_invariant(ev->nte_tm) &&
+		ergo(ev->nte_type == M0_NET_TEV_STATE_CHANGE,
+		     m0_net__tm_state_is_valid(ev->nte_next_state) &&
+		     (ev->nte_next_state != M0_NET_TM_STARTED ||
+		      m0_net__ep_invariant(ev->nte_ep, ev->nte_tm, true)));
 }
 
 M0_INTERNAL bool m0_net__tm_invariant(const struct m0_net_transfer_mc *tm)
-- 
1.8.3.2

