From 8addf7ae248cf9d5fa4fed1a4b165f29a416776b Mon Sep 17 00:00:00 2001
From: Hua Huang <hua_huang@xyratex.com>
Date: Fri, 8 Feb 2013 00:19:30 +0800
Subject: [PATCH 10/11] use mo_attr.ca_lid to pass layout id.

---
 m0t1fs/linux_kernel/dir.c    | 8 ++++----
 m0t1fs/linux_kernel/m0t1fs.h | 1 -
 2 files changed, 4 insertions(+), 5 deletions(-)

diff --git a/m0t1fs/linux_kernel/dir.c b/m0t1fs/linux_kernel/dir.c
index 1959e1c0..6747b4f 100644
--- a/m0t1fs/linux_kernel/dir.c
+++ b/m0t1fs/linux_kernel/dir.c
@@ -917,7 +917,7 @@ static int m0t1fs_mds_cob_fop_populate(const struct m0t1fs_mdop *mo,
 
 		layout = m0_fop_data(fop);
 		layout->l_op  = mo->mo_layout_op;
-		layout->l_lid = mo->mo_layout_id;
+		layout->l_lid = mo->mo_attr.ca_lid;
 
 		if (layout->l_op == M0_LAYOUT_OP_ADD ||
 		    layout->l_op == M0_LAYOUT_OP_DELETE) {
@@ -1108,9 +1108,9 @@ int m0t1fs_layout_op(struct m0t1fs_sb *csb, enum m0_layout_opcode op,
 			M0_RETURN(-ENOENT);
 	}
 
-	mo.mo_layout_op = op;
-	mo.mo_layout_id = lid;
-	mo.mo_layout    = layout;
+	mo.mo_layout_op   = op;
+	mo.mo_attr.ca_lid = lid;
+	mo.mo_layout      = layout;
 
 	rc = m0t1fs_mds_cob_op(csb, &mo, &m0_fop_layout_fopt, (void **)&rep);
 	M0_LOG(M0_DEBUG, "layout rep rc = %d", rc);
diff --git a/m0t1fs/linux_kernel/m0t1fs.h b/m0t1fs/linux_kernel/m0t1fs.h
index 252867a..e2d22c5 100644
--- a/m0t1fs/linux_kernel/m0t1fs.h
+++ b/m0t1fs/linux_kernel/m0t1fs.h
@@ -614,7 +614,6 @@ struct m0t1fs_filedata {
 struct m0t1fs_mdop {
         struct m0_cob_attr         mo_attr;
         enum m0_layout_opcode      mo_layout_op;
-        uint64_t                   mo_layout_id;
         struct m0_layout          *mo_layout;
 };
 
-- 
1.8.3.2

