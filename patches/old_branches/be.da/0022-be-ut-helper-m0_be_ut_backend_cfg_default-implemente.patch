From 5fdf0ef67b978d82830fb5a0e64465730c67b0cf Mon Sep 17 00:00:00 2001
From: Maxim Medved <Max_Medved@xyratex.com>
Date: Wed, 21 Aug 2013 14:36:52 +0300
Subject: [PATCH 22/34] be/ut/helper: m0_be_ut_backend_cfg_default()
 implemented

---
 be/ut/helper.c | 32 +++++++++++++++++---------------
 be/ut/helper.h |  6 ++++++
 2 files changed, 23 insertions(+), 15 deletions(-)

diff --git a/be/ut/helper.c b/be/ut/helper.c
index 569ede9..12fdc09 100644
--- a/be/ut/helper.c
+++ b/be/ut/helper.c
@@ -241,25 +241,27 @@ static void m0_be_ut_sm_group_thread_fini(struct m0_be_ut_sm_group_thread *sgt)
 	m0_free(sgt);
 }
 
-void m0_be_ut_backend_init(struct m0_be_ut_backend *ut_be)
+void m0_be_ut_backend_cfg_default(struct m0_be_domain_cfg *cfg)
 {
-	int rc;
-
-	*ut_be = (struct m0_be_ut_backend) {
-		.but_dom_cfg = {
-			.bc_engine = {
-				.bec_group_nr = 1,
-				.bec_log_size = 1 << 27,
-				.bec_tx_size_max = M0_BE_TX_CREDIT_INIT(
-					1 << 20, 1 << 26),
-				.bec_group_size_max = M0_BE_TX_CREDIT_INIT(
-					1 << 21, 1 << 27),
-				.bec_group_tx_max = 20,
-				.bec_group_fom_reqh = be_ut_reqh_get(),
-			},
+	*cfg = (struct m0_be_domain_cfg) {
+		.bc_engine = {
+			.bec_group_nr = 1,
+			.bec_log_size = 1 << 27,
+			.bec_tx_size_max = M0_BE_TX_CREDIT_INIT(
+				1 << 20, 1 << 26),
+			.bec_group_size_max = M0_BE_TX_CREDIT_INIT(
+				1 << 21, 1 << 27),
+			.bec_group_tx_max = 20,
 		},
 	};
+}
+
+void m0_be_ut_backend_init(struct m0_be_ut_backend *ut_be)
+{
+	int rc;
 
+	m0_be_ut_backend_cfg_default(&ut_be->but_dom_cfg);
+	ut_be->but_dom_cfg.bc_engine.bec_group_fom_reqh = be_ut_reqh_get();
 	m0_mutex_init(&ut_be->but_sgt_lock);
 	rc = m0_be_domain_init(&ut_be->but_dom, &ut_be->but_dom_cfg);
 	M0_ASSERT(rc == 0);
diff --git a/be/ut/helper.h b/be/ut/helper.h
index 8190f47..4ba6ada 100644
--- a/be/ut/helper.h
+++ b/be/ut/helper.h
@@ -48,6 +48,12 @@ struct m0_be_ut_backend {
 	struct m0_mutex			  but_sgt_lock;
 };
 
+/*
+ * Fill cfg with default configuration.
+ * @note bec_group_fom_reqh is not set here
+ */
+void m0_be_ut_backend_cfg_default(struct m0_be_domain_cfg *cfg);
+
 void m0_be_ut_backend_init(struct m0_be_ut_backend *ut_be);
 void m0_be_ut_backend_fini(struct m0_be_ut_backend *ut_be);
 
-- 
1.8.3.2

