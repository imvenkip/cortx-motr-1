From 3728a4d69bc77468cc6c2a2524ea2326222dfdd8 Mon Sep 17 00:00:00 2001
From: Maxim Medved <Max_Medved@xyratex.com>
Date: Fri, 25 Jan 2013 20:20:40 +0200
Subject: [PATCH 17/99] ++ntcrc_recv_enqueue_errors after unsuccessful
 m0_net_test_commands_recv_enqueue()

---
 net/test/console.c | 6 ++----
 1 file changed, 2 insertions(+), 4 deletions(-)

diff --git a/net/test/console.c b/net/test/console.c
index bc9eba1..e98f275 100644
--- a/net/test/console.c
+++ b/net/test/console.c
@@ -345,13 +345,11 @@ size_t m0_net_test_console_cmd(struct m0_net_test_console_ctx *ctx,
 			if (rctx->ntcrc_status[j] == 0)
 				success_nr++;
 		}
-		/*
-		 * @todo console user can't recover from this error -
-		 * cmd->ntc_buf_index is lost. use ringbuf to save?
-		 */
 reuse_cmd:
 		rc = m0_net_test_commands_recv_enqueue(cmd_ctx,
 						       cmd->ntc_buf_index);
+		if (rc != 0)
+			++rctx->ntcrc_recv_enqueue_errors;
 		if (j != -1) {
 			M0_ASSERT(j >= 0 && j < nodes->ntsl_nr);
 			rctx->ntcrc_errno[j] = rc;
-- 
1.8.3.2

