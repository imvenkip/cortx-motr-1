From 56149a4cca2ff79a780ea4a6cf347cdaf8422d93 Mon Sep 17 00:00:00 2001
From: "Valery V. Vorotyntsev" <valery_vorotyntsev@xyratex.com>
Date: Wed, 4 Jul 2012 22:36:15 +0300
Subject: [PATCH 221/370] c2_confc_init(): allocate an object outside of locks

LogD #267
RB: r/865
---
 conf/confc.c | 9 ++++++---
 1 file changed, 6 insertions(+), 3 deletions(-)

diff --git a/conf/confc.c b/conf/confc.c
index 32b5bba..12f5558 100644
--- a/conf/confc.c
+++ b/conf/confc.c
@@ -305,15 +305,18 @@ int c2_confc_init(struct c2_confc *confc, const char *conf_source,
 	 * C2_PRE(conf_source != NULL && *conf_source != 0);
 	 * C2_PRE(profile != NULL && *profile != 0);
 	 *
+	 * root = c2_conf_obj_new(C2_CO_PROFILE, &(const struct c2_conf_buf)
+	 *                        C2_CONF_BUF_STR(profile));
+	 * if (root == NULL)
+	 *     return -ENOMEM;
+	 * root->co_confc = confc;
+	 *
 	 * c2_mutex_lock(&sm_group->s_lock);
 	 * c2_mutex_lock(lock);
 	 *
 	 * confc->cc_group = sm_group;
 	 * confc->cc_lock = lock;
 	 *
-	 * root = c2_conf_obj_new(C2_CO_PROFILE, &(const struct c2_conf_buf)
-	 *                        C2_CONF_BUF_STR(profile));
-	 * root->co_confc = confc;
 	 * c2_conf_map_init(&confc->cc_registry);
 	 * c2_conf_map_add(&confc->cc_registry, root);
 	 * confc->cc_root = root;
-- 
1.8.3.2

