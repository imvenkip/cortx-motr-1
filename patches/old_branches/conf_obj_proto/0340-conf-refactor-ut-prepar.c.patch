From 8983e68807bd0fc7b3c8db2aa56a17e86754b0ea Mon Sep 17 00:00:00 2001
From: "Valery V. Vorotyntsev" <valery_vorotyntsev@xyratex.com>
Date: Thu, 30 Aug 2012 14:37:47 +0300
Subject: [PATCH 340/370] conf: refactor ut/prepar.c

Use fread() instead of looped getchar().
---
 conf/ut/prepar.c | 31 +++++++++----------------------
 1 file changed, 9 insertions(+), 22 deletions(-)

diff --git a/conf/ut/prepar.c b/conf/ut/prepar.c
index 9f2084f..6549530 100644
--- a/conf/ut/prepar.c
+++ b/conf/ut/prepar.c
@@ -1,30 +1,17 @@
-#include <stdio.h>
-#include <string.h>
 #include "conf/preload.h"
-
-enum {
-	KB = (1 << 10)
-};
-
-static char buf[32*KB];
+#include <stdio.h>
 
 int main(void)
 {
-	int c;
-	int i = 0;
-
-	memset(buf, 0, 32*KB);
-
-	while ((c = getchar()) != EOF) {
-		buf[i++] = c;
-		if (i >= 32*KB)
-			return -1;
-	}
-
-	buf[i] = '\0';
+	enum { KB = 1 << 10 };
+	char   buf[32*KB] = {0};
+	size_t n;
 
-	i = c2_conf_parse(buf, NULL, 0);
-	printf("entries: %d\n", i);
+	n = fread(buf, 1, sizeof buf, stdin);
+	if (n <= 0)
+		return 1;
+	buf[n] = '\0';
 
+	printf("entries: %d\n", c2_conf_parse(buf, NULL, 0));
 	return 0;
 }
-- 
1.8.3.2

