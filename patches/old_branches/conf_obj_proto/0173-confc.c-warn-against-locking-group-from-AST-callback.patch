From bca5e61db0e1882be4aa0635a62f8663b5d20520 Mon Sep 17 00:00:00 2001
From: "Valery V. Vorotyntsev" <valery_vorotyntsev@xyratex.com>
Date: Sat, 12 May 2012 01:45:43 +0300
Subject: [PATCH 173/370] confc.c: warn against locking group from AST
 callbacks

LogD: #1192
RB: r/714
---
 conf/confc.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/conf/confc.c b/conf/confc.c
index 9573331..90fe42f 100644
--- a/conf/confc.c
+++ b/conf/confc.c
@@ -250,7 +250,9 @@
  * cache lock (c2_confc::cc_lock).
  *
  * If a function needs both locks -- group lock and cache lock -- for
- * its operation, group lock must be acquired first.
+ * its operation, group lock must be acquired first. (Note, that the
+ * "function" here cannot be something invoked from an AST callback,
+ * because otherwise it would deadlock on the group mutex.)
  *
  * A user managing the state machine group (c2_confc::cc_group) is
  * responsible for making sure c2_sm_asts_run() is called when
-- 
1.8.3.2

