From 6ae8e2b20a6fd1c1b7fe0e0f4b10f519fd5b90bc Mon Sep 17 00:00:00 2001
From: Yuriy Umanets <yuriy_umanets@xyratex.com>
Date: Wed, 25 May 2011 08:29:32 -0600
Subject: [PATCH 094/158] - check for NULL fop in nrs that may happen while
 using it in replicator

---
 nrs/nrs.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/nrs/nrs.c b/nrs/nrs.c
index 35385a7..07d9bad 100644
--- a/nrs/nrs.c
+++ b/nrs/nrs.c
@@ -63,8 +63,10 @@ void c2_nrs_fini(struct c2_nrs *nrs)
 void c2_nrs_enqueue(struct c2_nrs *nrs, struct c2_fop *fop, void *cookie)
 {
 	C2_ASSERT(nrs->s_pol != NULL);
-        C2_ADDB_ADD(&fop->f_addb, &nrs_addb, 
-                    c2_addb_func_fail, "nrs_enqueue", 0);
+	if (fop != NULL) {
+                C2_ADDB_ADD(&fop->f_addb, &nrs_addb, 
+                            c2_addb_func_fail, "nrs_enqueue", 0);
+        }
 	nrs->s_pol->sp_enqueue(nrs, fop, cookie);
 }
 
-- 
1.8.3.2

