From 1eb22279c9937ecfb83c522749f77afd31c47e20 Mon Sep 17 00:00:00 2001
From: Andrew Perepechko <andrew_perepechko@xyratex.com>
Date: Thu, 9 Jun 2011 21:17:42 +0400
Subject: [PATCH 121/158] Revert "only abort transaction on EDEADLK"

This reverts commit ed4cbc4b9a483dd2bfd08e8044d77a7fd8a63332.
---
 mdstore/mdstore.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/mdstore/mdstore.c b/mdstore/mdstore.c
index a44a48b..bd5cd0a 100644
--- a/mdstore/mdstore.c
+++ b/mdstore/mdstore.c
@@ -909,9 +909,9 @@ restart:
         }
 out:
         if (rc) {
+                c2_db_tx_abort(tx);
+                c2_db_tx_init(tx, md->md_dom.cd_dbenv, 0);
                 if (rc == -EDEADLK) {
-                        c2_db_tx_abort(tx);
-                        c2_db_tx_init(tx, md->md_dom.cd_dbenv, 0);
                         memset(*path, 0, PATH_MAX);
                         goto restart;
                 }
-- 
1.8.3.2

