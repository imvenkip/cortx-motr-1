From e88e65c25dd5909ec35b064ab03409bf1bb66f45 Mon Sep 17 00:00:00 2001
From: Alexander Gattin <alexander_gattin@xyratex.com>
Date: Mon, 11 Feb 2013 12:24:30 +0200
Subject: [PATCH 23/25] m0t1fs/st: use bash's ${XXX:-YYY} expansion instead of
 [ -z "$XXX" ] && ...

---
 m0t1fs/linux_kernel/st/st | 17 +++++++----------
 1 file changed, 7 insertions(+), 10 deletions(-)

diff --git a/m0t1fs/linux_kernel/st/st b/m0t1fs/linux_kernel/st/st
index c5b98de..d75922c 100755
--- a/m0t1fs/linux_kernel/st/st
+++ b/m0t1fs/linux_kernel/st/st
@@ -1,21 +1,18 @@
 #!/bin/bash
 set -e
+set -u
 
 ## CAUTION: This path will be removed by superuser.
 SANDBOX_DIR=~devvm/_m0-sandbox
 
 # TRACE_MASK=all
-[ -z "$TRACE_MASK" ] && TRACE_MASK='!rpc,formation,fop,memory'
-[ -z "$TRACE_LEVEL" ] && TRACE_LEVEL='info+'
-[ -z "$M0_TRACE_LEVEL" ] && M0_TRACE_LEVEL="$TRACE_LEVEL"
-export M0_TRACE_LEVEL
-[ -z "$M0_TRACE_IMMEDIATE_MASK" ] && M0_TRACE_IMMEDIATE_MASK="$TRACE_MASK"
-export M0_TRACE_IMMEDIATE_MASK
-[ -z "$M0_TRACE_PRINT_CONTEXT" ] && [ -n "$TRACE_CONTEXT" ] && \
-    M0_TRACE_PRINT_CONTEXT="$TRACE_CONTEXT"
-[ -n "$M0_TRACE_PRINT_CONTEXT" ] && export M0_TRACE_PRINT_CONTEXT
+TRACE_MASK="${TRACE_MASK:-!rpc,formation,fop,memory}"
+TRACE_LEVEL="${TRACE_LEVEL:-info+}"
 # TRACE_CONTEXT=full
-set -u
+M0_TRACE_LEVEL="${M0_TRACE_LEVEL:-$TRACE_LEVEL}"
+M0_TRACE_IMMEDIATE_MASK="${M0_TRACE_IMMEDIATE_MASK:-$TRACE_MASK}"
+M0_TRACE_PRINT_CONTEXT="${M0_TRACE_PRINT_CONTEXT:-${TRACE_CONTEXT:-}}"
+export M0_TRACE_LEVEL M0_TRACE_IMMEDIATE_MASK M0_TRACE_IMMEDIATE_MASK
 
 MAX_RPC_MSG_SIZE=163840
 TM_MIN_RECV_QUEUE_LEN=2
-- 
1.8.3.2

