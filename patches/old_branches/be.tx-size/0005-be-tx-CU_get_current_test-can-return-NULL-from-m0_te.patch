From 4a8763aa9c86b6ef2bd43c28c27191a51346cfa0 Mon Sep 17 00:00:00 2001
From: Maxim Medved <max_medved@xyratex.com>
Date: Mon, 30 Sep 2013 19:22:52 +0300
Subject: [PATCH 5/5] be/tx: CU_get_current_test() can return NULL from
 m0_test_suite::ts_init()

---
 be/tx.c | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/be/tx.c b/be/tx.c
index 5930eca..51fe130 100644
--- a/be/tx.c
+++ b/be/tx.c
@@ -235,6 +235,8 @@ M0_INTERNAL void m0_be_tx_open(struct m0_be_tx *tx)
 #ifndef __KERNEL__
 	extern CU_pSuite CU_get_current_suite(void);
 	extern CU_pTest  CU_get_current_test(void);
+	const char	*name_suite;
+	const char	*name_test;
 #endif
 
 	if (!initialized) {
@@ -251,8 +253,11 @@ M0_INTERNAL void m0_be_tx_open(struct m0_be_tx *tx)
 		dprintf(2, "\"%s\" ", strings[j]);
 	free(strings);
 #ifndef __KERNEL__
-	dprintf(2, "test{%s:%s}\n", CU_get_current_suite()->pName,
-		CU_get_current_test()->pName);
+	name_suite = CU_get_current_suite() != NULL ?
+		     CU_get_current_suite()->pName : "unknown";
+	name_test = CU_get_current_test() != NULL ?
+		    CU_get_current_test()->pName : "init_fini";
+	dprintf(2, "test{%s:%s}\n", name_suite, name_test);
 #else
 	dprintf(2, "\n");
 #endif
-- 
1.8.3.2

