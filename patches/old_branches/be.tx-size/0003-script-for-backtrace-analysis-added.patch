From ee43ef9d8b4a87343ce94af10fc9166d0c5b7818 Mon Sep 17 00:00:00 2001
From: Anatoliy Bilenko <anatoliy_bilenko@xyratex.com>
Date: Mon, 30 Sep 2013 15:00:59 +0300
Subject: [PATCH 3/5] script for backtrace analysis added.

      - usage: ./backtrace.pl < backtrace.txt
---
 backtrace.pl  | 25 +++++++++++++++++++++++++
 backtrace.txt |  3 +++
 2 files changed, 28 insertions(+)
 create mode 100755 backtrace.pl
 create mode 100644 backtrace.txt

diff --git a/backtrace.pl b/backtrace.pl
new file mode 100755
index 0000000..c5b0588
--- /dev/null
+++ b/backtrace.pl
@@ -0,0 +1,25 @@
+#!/usr/bin/perl
+use strict;
+use List::Util qw(min max);
+
+my $line;
+my %map;
+my $key;
+
+while ($line = <STDIN>) {
+    chomp($line);
+
+    $line =~ s/\".*?\((.*?)\).*?\"/ $1 /g;
+    $line =~ s/\+0x[0-9a-fA-F]+//g;
+    $line =~ s/[ ]+/ /g;
+
+    if ($line =~ /([0-9]+) ([0-9]+) (.*)/g) {
+	$map{ $3 } = max($1, $map{ $3 }); # sort by MB
+	# $map{ $3 } = max($2, $map{ $3 }); # sort by reg size
+    }
+}
+
+
+foreach (sort { $map{ $b } <=> $map{ $a } } keys %map) {
+    print "$map{$_} |> $_\n";
+}
diff --git a/backtrace.txt b/backtrace.txt
new file mode 100644
index 0000000..53185d8
--- /dev/null
+++ b/backtrace.txt
@@ -0,0 +1,3 @@
+16 1679 "/work/mero-backend/mero/.libs/libmero-0.1.0.so(m0_be_tx_open+0x47) [0x7ffff7291cd7]" "/work/mero-backend/utils/.libs/lt-ut(m0_be_ut_tx_persistence+0x191) [0x44ce71]" "/work/mero-backend/extra-libs/cunit/CUnit/Sources/.libs/libcunit.so.1(+0x6f5b) [0x7ffff7df3f5b]" "/work/mero-backend/extra-libs/cunit/CUnit/Sources/.libs/libcunit.so.1(CU_run_test+0x1e1) [0x7ffff7df1dfc]" "/work/mero-backend/extra-libs/cunit/CUnit/Sources/.libs/libcunit.so.1(+0x88fa) [0x7ffff7df58fa]" "/work/mero-backend/extra-libs/cunit/CUnit/Sources/.libs/libcunit.so.1(CU_basic_run_test+0x51) [0x7ffff7df56a9]" "/work/mero-backend/utils/.libs/lt-ut() [0x4d2dd6]" "/work/mero-backend/utils/.libs/lt-ut(m0_ut_run+0xf6) [0x4d2f76]" "/work/mero-backend/utils/.libs/lt-ut(main+0x9aa) [0x42d31a]" "/lib64/libc.so.6(__libc_start_main+0xfd) [0x370181ec9d]" "/work/mero-backend/utils/.libs/lt-ut() [0x42c579]"
+16 2567 "/work/mero-backend/mero/.libs/libmero-0.1.0.so(m0_be_tx_open+0x47) [0x7ffff7291cd7]" "/work/mero-backend/utils/.libs/lt-ut(m0_be_ut_tx_persistence+0x191) [0x44ce71]" "/work/mero-backend/extra-libs/cunit/CUnit/Sources/.libs/libcunit.so.1(+0x6f5b) [0x7ffff7df3f5b]" "/work/mero-backend/extra-libs/cunit/CUnit/Sources/.libs/libcunit.so.1(CU_run_test+0x1e1) [0x7ffff7df1dfc]" "/work/mero-backend/extra-libs/cunit/CUnit/Sources/.libs/libcunit.so.1(+0x88fa) [0x7ffff7df58fa]" "/work/mero-backend/extra-libs/cunit/CUnit/Sources/.libs/libcunit.so.1(CU_basic_run_test+0x51) [0x7ffff7df56a9]" "/work/mero-backend/utils/.libs/lt-ut() [0x4d2dd6]" "/work/mero-backend/utils/.libs/lt-ut(m0_ut_run+0xf6) [0x4d2f76]" "/work/mero-backend/utils/.libs/lt-ut(main+0x9aa) [0x42d31a]" "/lib64/libc.so.6(__libc_start_main+0xfd) [0x370181ec9d]" "/work/mero-backend/utils/.libs/lt-ut() [0x42c579]"
+16 2121 "/work/mero-backend/mero/.libs/libmero-0.1.0.so(m0_be_tx_open+0x47) [0x7ffff7291cd7]" "/work/mero-backend/utils/.libs/lt-ut(m0_be_ut_tx_persistence+0x191) [0x44ce71]" "/work/mero-backend/extra-libs/cunit/CUnit/Sources/.libs/libcunit.so.1(+0x6f5b) [0x7ffff7df3f5b]" "/work/mero-backend/extra-libs/cunit/CUnit/Sources/.libs/libcunit.so.1(CU_run_test+0x1e1) [0x7ffff7df1dfc]" "/work/mero-backend/extra-libs/cunit/CUnit/Sources/.libs/libcunit.so.1(+0x88fa) [0x7ffff7df58fa]" "/work/mero-backend/extra-libs/cunit/CUnit/Sources/.libs/libcunit.so.1(CU_basic_run_test+0x51) [0x7ffff7df56a9]" "/work/mero-backend/utils/.libs/lt-ut() [0x4d2dd6]" "/work/mero-backend/utils/.libs/lt-ut(m0_ut_run+0xf6) [0x4d2f76]" "/work/mero-backend/utils/.libs/lt-ut(main+0x9aa) [0x42d31a]" "/lib64/libc.so.6(__libc_start_main+0xfd) [0x370181ec9d]" "/work/mero-backend/utils/.libs/lt-ut() [0x42c579]"
-- 
1.8.3.2

