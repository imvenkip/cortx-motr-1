From 56ccc0bebbbf682350bf338a581661b4487c4332 Mon Sep 17 00:00:00 2001
From: Maxim Medved <max_medved@xyratex.com>
Date: Mon, 30 Sep 2013 14:00:12 +0300
Subject: [PATCH 1/5] be/tx: added tx size logging

---
 be/tx.c | 18 ++++++++++++++++++
 1 file changed, 18 insertions(+)

diff --git a/be/tx.c b/be/tx.c
index d385046..e00ba24 100644
--- a/be/tx.c
+++ b/be/tx.c
@@ -18,6 +18,11 @@
  * Original creation date: 29-May-2013
  */
 
+#include <stdio.h>
+#include <execinfo.h>
+#include <unistd.h>
+#include <stdlib.h>
+
 #include <stddef.h>		/* ptrdiff_t */
 
 #define M0_TRACE_SUBSYSTEM M0_TRACE_SUBSYS_BE
@@ -219,6 +224,19 @@ m0_be_tx_prep(struct m0_be_tx *tx, const struct m0_be_tx_credit *credit)
 M0_INTERNAL void m0_be_tx_open(struct m0_be_tx *tx)
 {
 	int rc;
+	int j, nptrs;
+#define SIZE 100
+	void *buffer[100];
+	char **strings;
+
+	dprintf(2, "%lu %lu ", tx->t_prepared.tc_reg_nr, tx->t_prepared.tc_reg_size);
+
+	nptrs = backtrace(buffer, SIZE);
+	strings = backtrace_symbols(buffer, nptrs);
+	M0_ASSERT(strings != NULL);
+	for (j = 0; j < nptrs; j++)
+		dprintf(2, "\"%s\"%c", strings[j], j == nptrs - 1 ? '\n' : ' ');
+	free(strings);
 
 	M0_ENTRY();
 	M0_PRE(BE_TX_LOCKED_AT_STATE(tx, (M0_BTS_PREPARE)));
-- 
1.8.3.2

