From 63a442f81e625a1946663912463d7dc6af32f8d4 Mon Sep 17 00:00:00 2001
From: Mandar Sawant <mandar_sawant@xyratex.com>
Date: Thu, 6 Feb 2014 18:40:25 +0530
Subject: [PATCH 6/9] be.conv.use-real-reqh, - Temporary fix for blocking
 poolmachine event post mechanism.

---
 sns/cm/cm.c | 7 +++----
 1 file changed, 3 insertions(+), 4 deletions(-)

diff --git a/sns/cm/cm.c b/sns/cm/cm.c
index 6089953..10d45ba 100644
--- a/sns/cm/cm.c
+++ b/sns/cm/cm.c
@@ -553,14 +553,13 @@ M0_INTERNAL int m0_sns_cm_pm_event_post(struct m0_sns_cm *scm,
 			struct m0_pool_event   pme;
 			struct m0_be_tx_credit cred = {};
 			struct m0_be_tx        tx;
-			struct m0_sm_group    *grp  = m0_locality0_get()->lo_grp;
+			struct m0_sm_group    *grp  = m0_locality_here()->lo_grp;
 
 			M0_SET0(&pme);
 			pme.pe_type  = et;
 			pme.pe_index = dev_id;
 			pme.pe_state = state;
-
-			m0_sm_group_lock(grp);
+			//m0_sm_group_lock(grp);
 			m0_be_tx_init(&tx, 0, scm->sc_it.si_beseg->bs_domain, grp,
 					      NULL, NULL, NULL, NULL);
 			m0_poolmach_store_credit(scm->sc_base.cm_pm, &cred);
@@ -573,7 +572,7 @@ M0_INTERNAL int m0_sns_cm_pm_event_post(struct m0_sns_cm *scm,
 				m0_be_tx_close_sync(&tx);
 			}
 			m0_be_tx_fini(&tx);
-			m0_sm_group_unlock(grp);
+			//m0_sm_group_unlock(grp);
 			if (rc != 0)
 				break;
 		}
-- 
1.8.3.2

