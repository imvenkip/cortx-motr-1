From 8e460149091c27b25ea35db19f949dc15aee0160 Mon Sep 17 00:00:00 2001
From: "Valery V. Vorotyntsev" <valery_vorotyntsev@xyratex.com>
Date: Wed, 19 Jun 2013 18:51:31 +0300
Subject: [PATCH 178/228] be: add M0_ENTRY() to m0_tx_processing_start()

+ s/conf/tx_fom_conf/ -- this improves readability.
+ Whitespace fixes.
---
 be/be.h     | 10 +++++-----
 be/tx.h     |  3 +--
 be/tx_fom.c |  7 +++++--
 be/tx_fom.h |  6 +++---
 4 files changed, 14 insertions(+), 12 deletions(-)

diff --git a/be/be.h b/be/be.h
index 1dcee75..c41c34b 100644
--- a/be/be.h
+++ b/be/be.h
@@ -64,12 +64,12 @@ enum m0_be_op_type {
 };
 
 struct m0_be_op {
-	struct m0_sm        bo_sm;
-	struct m0_fom      *bo_fom;
-	struct m0_sm_group  bo_sm_grp;	/** @todo XXX TODO remove it! */
+	struct m0_sm       bo_sm;
+	struct m0_fom     *bo_fom;
+	struct m0_sm_group bo_sm_grp;	/** @todo XXX TODO remove it! */
 
-	enum m0_be_op_type  bo_utype; /* bo_u type */
-	struct m0_be_op    *bo_parent_op;
+	enum m0_be_op_type bo_utype; /* bo_u type */
+	struct m0_be_op   *bo_parent_op;
 	union {
 		/* Used by m0_be_reg_get(). */
 		struct m0_be_reg                   u_reg;
diff --git a/be/tx.h b/be/tx.h
index 5005668..f9d7ef4 100644
--- a/be/tx.h
+++ b/be/tx.h
@@ -29,14 +29,13 @@
 #include "be/tx_group.h"
 #include "be/tx_log.h"
 
-/** @todo XXX TODO added by max as a temporary fix of compilation error */
+/** @todo XXX FIXME (added by Max as a temporary fix of compilation error) */
 typedef uint64_t m0_bindex_lsn;
 
 struct m0_stob;
 struct m0_be;
 struct m0_be_tx_engine;
 struct m0_be_tx;
-
 struct m0_be_reg_d;
 struct m0_be_reg;
 
diff --git a/be/tx_fom.c b/be/tx_fom.c
index 9bbf857..a2918d1 100644
--- a/be/tx_fom.c
+++ b/be/tx_fom.c
@@ -75,7 +75,7 @@ static struct m0_sm_state_descr descr[] = {
 #undef _S
 };
 
-static struct m0_sm_conf conf = {
+static struct m0_sm_conf tx_fom_conf = {
 	.scf_name      = "tx_fom states",
 	.scf_nr_states = ARRAY_SIZE(descr),
 	.scf_state     = descr
@@ -203,13 +203,16 @@ m0_tx_processing_start(struct m0_reqh *reqh, struct m0_be_tx_engine *eng)
 	struct m0_fom *fom;
 	int            rc;
 
+	M0_ENTRY();
 	M0_PRE(m0_reqh_state_get(reqh) == M0_REQH_ST_NORMAL);
 
-	m0_fom_type_init(&tx_fom_type, &tx_fom_type_ops, &m0_txs_stype, &conf);
+	m0_fom_type_init(&tx_fom_type, &tx_fom_type_ops, &m0_txs_stype,
+			 &tx_fom_conf);
 
 	rc = tx_fom_create(&fom, reqh, eng);
 	if (rc == 0)
 		m0_fom_queue(fom, reqh);
+
 	M0_RETURN(rc);
 }
 
diff --git a/be/tx_fom.h b/be/tx_fom.h
index 1e66542..62e9c9d 100644
--- a/be/tx_fom.h
+++ b/be/tx_fom.h
@@ -19,25 +19,25 @@
  */
 
 #pragma once
-
 #ifndef __MERO_BE_TX_FOM_H__
 #define __MERO_BE_TX_FOM_H__
 
+struct m0_reqh;
 struct m0_be_tx_engine;
 
 /**
  * @defgroup be
  * @{
  */
+
 M0_INTERNAL int m0_tx_processing_start(struct m0_reqh *reqh,
 				       struct m0_be_tx_engine *eng);
+
 M0_INTERNAL void m0_tx_processing_stop(void);
 
 /** @} end of be group */
-
 #endif /* __MERO_BE_TX_FOM_H__ */
 
-
 /*
  *  Local variables:
  *  c-indentation-style: "K&R"
-- 
1.8.3.2

