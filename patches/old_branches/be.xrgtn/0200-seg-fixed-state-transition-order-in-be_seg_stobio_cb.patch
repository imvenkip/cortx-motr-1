From ba369f3231439c5c2fcdcf159d13e98d96dff25f Mon Sep 17 00:00:00 2001
From: Anatoliy Bilenko <anatoliy_bilenko@xyratex.com>
Date: Fri, 21 Jun 2013 11:58:37 +0300
Subject: [PATCH 200/228] seg: fixed state transition order in
 be_seg_stobio_cb().

---
 be/seg.c | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/be/seg.c b/be/seg.c
index fa74904..2526d81 100644
--- a/be/seg.c
+++ b/be/seg.c
@@ -363,9 +363,8 @@ M0_INTERNAL void m0_be_seg_write_simple(struct m0_be_seg *seg,
 	iovec_prepare(seg, area, nr, &io->si_stob, &io->si_user);
 
 	m0_clink_add_lock(&io->si_wait, clink);
+	m0_be_op_state_set(op, M0_BOS_ACTIVE);
 	rc = m0_stob_io_launch(io, seg->bs_stob, NULL, NULL);
-	op->bo_sm.sm_rc = rc;
-	m0_be_op_state_set(op, rc == 0 ? M0_BOS_ACTIVE : M0_BOS_FAILURE);
 }
 
 M0_INTERNAL int
-- 
1.8.3.2

