From 645d61a24eebd28dd4f19c086eec2c8163cd3f61 Mon Sep 17 00:00:00 2001
From: "Valery V. Vorotyntsev" <valery_vorotyntsev@xyratex.com>
Date: Wed, 29 May 2013 10:47:03 +0300
Subject: [PATCH 027/228] be: add a union of opcode-specific fields to m0_be_op

---
 be/seg.h | 28 ++++++++++++++++++++++++++--
 1 file changed, 26 insertions(+), 2 deletions(-)

diff --git a/be/seg.h b/be/seg.h
index b7f8901..ca8f685 100644
--- a/be/seg.h
+++ b/be/seg.h
@@ -71,7 +71,29 @@ enum m0_be_op_state {
 };
 
 struct m0_be_op {
-	struct m0_sm bo_sm;
+	struct m0_sm   bo_sm;
+	struct m0_fom *bo_fom;
+
+	union {
+		/* Used by m0_be_reg_get(). */
+		const struct m0_be_reg *u_reg;
+
+		/* Used by m0_be_list_get(). */
+		struct {
+			const struct m0_be_list *l_list;
+			m0_bcount_t              l_nelems;
+		} u_list;
+
+		struct {
+			struct m0_be_btree        *t_tree;
+			struct m0_be_tx           *t_tx;
+			/* XXX to be defined in btree.c */
+			unsigned int               t_op;
+			const struct m0_buf       *t_in;
+			struct m0_buf             *t_out;
+			struct m0_be_btree_anchor *t_anchor;
+		} u_btree;
+	} bo_u;
 };
 
 enum m0_be_tx_state {
@@ -188,7 +210,7 @@ struct m0_be_reg {
 void m0_be_reg_get(const struct m0_be_reg *reg, struct m0_be_op *op);
 void m0_be_reg_get_fast(const struct m0_be_seg *reg);
 
-void m0_be_reg_put(const struct m0_be_reg *reg, struct m0_be_op *op);
+void m0_be_reg_put(const struct m0_be_reg *reg);
 
 /* ---------------------------------------------------------------- */
 
@@ -285,6 +307,8 @@ void m0_be_btree_lookup_inplace(struct m0_be_btree *tree, struct m0_be_op *op,
 				struct m0_be_btree_anchor *anchor);
 
 enum m0_be_btree_op {
+	M0_BBO_CREATE,
+	M0_BBO_DESTROY,
 	M0_BBO_INSERT,
 	M0_BBO_DELETE,
 	M0_BBO_UPDATE
-- 
1.8.3.2

