From c3465cf528ed69e39d626f7d5c3bcf2c9ece5e2f Mon Sep 17 00:00:00 2001
From: "Valery V. Vorotyntsev" <valery_vorotyntsev@xyratex.com>
Date: Wed, 29 May 2013 13:04:36 +0300
Subject: [PATCH 024/228] be: fix obvious bugs and comment out
 m0_be_seg_create()

---
 be/seg.c | 36 ++++++++++++++----------------------
 1 file changed, 14 insertions(+), 22 deletions(-)

diff --git a/be/seg.c b/be/seg.c
index 344e693..f236c7e 100644
--- a/be/seg.c
+++ b/be/seg.c
@@ -34,13 +34,12 @@
 #include "stob/linux.h"
 #include "stob/linux_internal.h"
 
-/* "on-disk" header for segment, stored in STOB at zero offset */
+/** "On-disk" header for segment, stored in STOB at zero offset. */
 struct be_seg_hdr {
-	void        *bh_addr;
-	m0_bcount_t  bh_size;
+	void       *bh_addr;
+	m0_bcount_t bh_size;
 };
 
-
 static void seg_header_prepare(struct m0_be_seg *seg, struct m0_stob_io *io)
 {
 	/** fill segment header */
@@ -73,27 +72,27 @@ static int seg_header_write(struct m0_be_seg *seg)
 
 int m0_be_seg_create(struct m0_be_seg *seg)
 {
-	int		   result;
+#if 1 /*XXX*/
+	return -1;
+#else
+	int rc;
 
 	M0_PRE(seg->bs_state == M0_BSS_INIT);
 	M0_PRE(seg->bs_stob->so_domain != NULL);
 	M0_PRE(seg->bs_stob->so_state != CSS_EXISTS);
 
-	result = m0_stob_create(&seg->bs_stob, NULL);
-
-	if (result != 0)
-		return result;
-
-	return stobio_write(seg);
+	rc = m0_stob_create(seg->bs_stob, NULL);
+	if (rc == 0)
+		stobio_write(seg); /* XXX FIXME: stobio_write() is unknown */
+	return rc;
+#endif /*XXX*/
 }
 
-
-
-int m0_be_seg_destroy(struct m0_be_seg *seg);
+int m0_be_seg_destroy(struct m0_be_seg *seg)
 {
 	M0_PRE(M0_IN(seg->bs_state, (M0_BSS_INIT, M0_BSS_CLOSED)));
 	m0_stob_put(seg->bs_stob);
-	//stob destroy ...
+	/* XXX TODO: stob destroy ... */
 }
 
 void
@@ -115,12 +114,6 @@ bool m0_be__reg_invariant(const struct m0_be_reg *reg)
 		reg->br_addr != NULL;
 }
 
-/** "On-disk" header for segment, stored in STOB at zero offset. */
-struct be_seg_hdr {
-	void       *bh_addr;
-	m0_bcount_t bh_size;
-};
-
 int m0_be_seg_open(struct m0_be_seg *seg)
 {
 #if 1 /*XXX*/
@@ -187,7 +180,6 @@ void m0_be_reg_put(const struct m0_be_reg *reg)
 }
 
 /** @} end of be group */
-
 /*
  *  Local variables:
  *  c-indentation-style: "K&R"
-- 
1.8.3.2

