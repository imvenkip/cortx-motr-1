From e3ec33e58584049ab6dd03167fa098e946d7d791 Mon Sep 17 00:00:00 2001
From: Yuriy Umanets <yuriy_umanets@xyratex.com>
Date: Sat, 30 Jul 2011 08:04:52 -0600
Subject: [PATCH 171/177] - fixed number of compile issues in colibri code; -
 disabled bdenv sync on fop handling.

---
 c2t1fs/main.c        | 20 ++++++++++++--------
 db/linux_kernel/db.c |  1 +
 lib/ut/processor.c   |  2 +-
 reqh/reqh.c          |  2 +-
 4 files changed, 15 insertions(+), 10 deletions(-)

diff --git a/c2t1fs/main.c b/c2t1fs/main.c
index fe0523e..6f8ab7e 100644
--- a/c2t1fs/main.c
+++ b/c2t1fs/main.c
@@ -816,15 +816,15 @@ static int c2t1fs_internal_read_write(struct c2t1fs_sb_info    *csi,
 
 	struct c2t1fs_conn_clt     *con;
 	struct page                *page;
-	struct page	          **parity_pages;
+	struct page	          **parity_pages = NULL;
 
-	struct c2_buf              *data_buf;
-	struct c2_buf              *parity_buf;
+	struct c2_buf              *data_buf = NULL;
+	struct c2_buf              *parity_buf = NULL;
 
 	struct c2t1fs_object_param *obj_param;
 
 	struct obj_map              objmap;
-	struct rpc_desc            *rpc;
+	struct rpc_desc            *rpc = NULL;
 
 	ENTER;
 
@@ -934,10 +934,14 @@ static int c2t1fs_internal_read_write(struct c2t1fs_sb_info    *csi,
 			__free_page(parity_pages[i]);
 	}
 
-	c2_free(parity_buf);
-	c2_free(parity_pages);
-	c2_free(rpc);
-	c2_free(data_buf);
+        if (parity_buf)
+	        c2_free(parity_buf);
+	if (parity_pages)
+	        c2_free(parity_pages);
+	if (rpc)
+	        c2_free(rpc);
+	if (data_buf)
+	        c2_free(data_buf);
 	obj_map_fini(&objmap, W, I);
 
 	return rc;
diff --git a/db/linux_kernel/db.c b/db/linux_kernel/db.c
index 8818b86..5c6869e 100644
--- a/db/linux_kernel/db.c
+++ b/db/linux_kernel/db.c
@@ -122,6 +122,7 @@ C2_EXPORTED(c2_db_tx_commit);
 int c2_db_tx_abort(struct c2_db_tx *tx)
 {
 	C2_IMPOSSIBLE("Aborting transaction in kernel space.");
+	return 0;
 }
 C2_EXPORTED(c2_db_tx_abort);
 
diff --git a/lib/ut/processor.c b/lib/ut/processor.c
index bf8989b..11c50a0 100644
--- a/lib/ut/processor.c
+++ b/lib/ut/processor.c
@@ -360,7 +360,7 @@ static void verify_map(int mapid)
 	char			buf[BUF_SZ],
 				result[BUF_SZ],
 				*expect,
-				*map_file,
+				*map_file = NULL,
 				filename[PATH_MAX];
 	int			rc;
 	FILE 			*fp;
diff --git a/reqh/reqh.c b/reqh/reqh.c
index e365969..36f073b 100644
--- a/reqh/reqh.c
+++ b/reqh/reqh.c
@@ -122,7 +122,7 @@ out:
                         goto restart;
         } else {
                 c2_db_tx_commit(&tx.tx_dbtx);
-                c2_dbenv_sync(reqh->rh_site->s_mdstore->md_dom.cd_dbenv);
+//                c2_dbenv_sync(reqh->rh_site->s_mdstore->md_dom.cd_dbenv);
         }
         
         return result;
-- 
1.8.3.2

