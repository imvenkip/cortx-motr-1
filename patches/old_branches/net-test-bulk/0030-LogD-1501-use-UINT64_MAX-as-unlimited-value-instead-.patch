From f229c1750a6a491796ba3ba2837f8e0f56cc58b0 Mon Sep 17 00:00:00 2001
From: Maxim Medved <Max_Medved@xyratex.com>
Date: Mon, 26 Nov 2012 09:47:16 +0200
Subject: [PATCH 30/58] LogD 1501: use UINT64_MAX as 'unlimited' value instead
 of 0

---
 net/test/node_helper.c | 12 +++---------
 net/test/node_helper.h | 12 ++++--------
 2 files changed, 7 insertions(+), 17 deletions(-)

diff --git a/net/test/node_helper.c b/net/test/node_helper.c
index 0326754..cb11630 100644
--- a/net/test/node_helper.c
+++ b/net/test/node_helper.c
@@ -40,7 +40,8 @@ void c2_net_test_nh_init(struct c2_net_test_nh *nh,
 	nh->ntnh_role		  = icmd->ntci_role;
 	nh->ntnh_type		  = icmd->ntci_type;
 	nh->ntnh_test_initialized = true;
-	nh->ntnh_transfers_max_nr = icmd->ntci_msg_nr;
+	nh->ntnh_transfers_max_nr = icmd->ntci_msg_nr == 0 ?
+				    UINT64_MAX : icmd->ntci_msg_nr;
 	/** @todo reset all stats */
 	c2_net_test_stats_reset(&nh->ntnh_sd.ntcsd_rtt);
 }
@@ -133,16 +134,9 @@ void c2_net_test_nh_sd_update_rtt(struct c2_net_test_nh *nh, c2_time_t rtt)
 
 bool c2_net_test_nh_transfer_next(struct c2_net_test_nh *nh)
 {
-	size_t max;
-	size_t started;
-
 	C2_PRE(c2_net_test_nh__invariant(nh));
 
-	max	= nh->ntnh_transfers_max_nr;
-	started = nh->ntnh_transfers_started_nr;
-	C2_PRE(ergo(max != 0, started <= max));
-
-	if (max != 0 && started == max)
+	if (nh->ntnh_transfers_started_nr == nh->ntnh_transfers_max_nr)
 		return false;
 	++nh->ntnh_transfers_started_nr;
 	return true;
diff --git a/net/test/node_helper.h b/net/test/node_helper.h
index 2fa8580..940ed82 100644
--- a/net/test/node_helper.h
+++ b/net/test/node_helper.h
@@ -86,15 +86,11 @@ struct c2_net_test_nh {
 	bool				   ntnh_test_initialized;
 	/**
 	 * Maximum number of message transfers (in both direction).
-	 * Value 0 means no limit.
+	 * Value UINT64_MAX means no limit.
 	 */
-	size_t				   ntnh_transfers_max_nr;
-	/**
-	 * Number of started transfers (including failed).
-	 * Should not exceed c2_net_test_nh.ntnh_transfers_max_nr if
-	 * it is >0.
-	 */
-	size_t				   ntnh_transfers_started_nr;
+	uint64_t			   ntnh_transfers_max_nr;
+	/** Number of started transfers (including failed) */
+	uint64_t			   ntnh_transfers_started_nr;
 };
 
 /** Initialize node helper structure. Take some information from icmd */
-- 
1.8.3.2

