From 254200f456f968adab0fd8c19b267abadf8fed28 Mon Sep 17 00:00:00 2001
From: Maxim Medved <Max_Medved@xyratex.com>
Date: Mon, 19 Nov 2012 17:24:10 +0200
Subject: [PATCH 03/58] fixed invlid paths in net-test ST

---
 configure.ac                       |  2 +-
 net/test/st/run-1x1.sh             |  2 +-
 net/test/st/st-bulk.sh             |  8 +++++---
 net/test/st/st-config-common.sh.in | 21 ---------------------
 net/test/st/st-config.sh.in        | 23 +++++++++++++++++++++++
 net/test/st/st-ping.sh             |  8 +++++---
 net/test/st/st.sh                  |  6 ++++--
 7 files changed, 39 insertions(+), 31 deletions(-)
 delete mode 100644 net/test/st/st-config-common.sh.in
 create mode 100644 net/test/st/st-config.sh.in

diff --git a/configure.ac b/configure.ac
index ee9cc35..90acdd1 100644
--- a/configure.ac
+++ b/configure.ac
@@ -728,7 +728,7 @@ AC_CONFIG_FILES([
 		 net/test/ntn.sh
 		 net/test/user_space/Makefile
 		 net/test/ut/Makefile
-		 net/test/st/st-config-common.sh
+		 net/test/st/st-config.sh
 		 net/ut/Makefile
                  nrs/Makefile
                  patches/Makefile
diff --git a/net/test/st/run-1x1.sh b/net/test/st/run-1x1.sh
index 10ed643..9851ff8 100644
--- a/net/test/st/run-1x1.sh
+++ b/net/test/st/run-1x1.sh
@@ -16,7 +16,7 @@ if [ "$(id -u)" -ne 0 ]; then
     exit 1
 fi
 
-. /work/git/colibri-net-test/core/c2t1fs/linux_kernel/st/common.sh
+source "$ST_COMMON"
 
 eval_kill_pid() {
 	eval pid=\${$1-xxx}
diff --git a/net/test/st/st-bulk.sh b/net/test/st/st-bulk.sh
index 0a58107..7653a60 100755
--- a/net/test/st/st-bulk.sh
+++ b/net/test/st/st-bulk.sh
@@ -1,9 +1,11 @@
 #!/bin/sh
 
-source ./st-config-common.sh
+CWD=$(cd "$( dirname "$0")" && pwd)
+
+source $CWD/st-config.sh
 TEST_TYPE="bulk"
 MSG_NR=1024
-MSG_SIZE="1m"
+MSG_SIZE=1m
 CONCURRENCY_CLIENT=8
 CONCURRENCY_SERVER=16
 BD_BUF_NR_CLIENT=16
@@ -11,4 +13,4 @@ BD_BUF_NR_SERVER=32
 BD_BUF_SIZE=4k
 BD_BUF_NR_MAX=8
 
-source ./run-1x1.sh
+source $CWD/run-1x1.sh
diff --git a/net/test/st/st-config-common.sh.in b/net/test/st/st-config-common.sh.in
deleted file mode 100644
index 415e263..0000000
--- a/net/test/st/st-config-common.sh.in
+++ /dev/null
@@ -1,21 +0,0 @@
-#!/bin/sh
-
-# Path to binaries
-NTN=@SRCDIR@/net/test/user_space/ntn
-NTN=@SRCDIR@/net/test/user_space/ntc
-
-# Time to wait for node loading.
-# Timeout is used here because there is no way to check for node readiness
-NODE_INIT_DELAY=3
-
-# Set to empty string to disable verbose output
-VERBOSE="-v"
-
-# Set to empty string to disable last line with parsable output
-PARSABLE="-p"
-
-LNET_IF="0@lo"
-LNET_PID=12345
-LNET_PORTAL=42
-
-LNET_PREFIX="$LNET_IF:$LNET_PID:$LNET_PORTAL"
diff --git a/net/test/st/st-config.sh.in b/net/test/st/st-config.sh.in
new file mode 100644
index 0000000..61b7130
--- /dev/null
+++ b/net/test/st/st-config.sh.in
@@ -0,0 +1,23 @@
+#!/bin/sh
+
+# Path to binaries
+NTN=@SRCDIR@/net/test/user_space/ntn
+NTN=@SRCDIR@/net/test/user_space/ntc
+ST_COMMON=@SCRDIR@/c2t1fs/linux_kernel/st/common.sh
+
+# Time to wait for node loading.
+# Timeout is used here because there is no way to check for node readiness
+NODE_INIT_DELAY=3
+
+# Set to empty string to disable verbose output
+VERBOSE=
+# VERBOSE="-v"
+
+# Set to empty string to disable last line with parsable output
+PARSABLE="-p"
+
+LNET_IF="0@lo"
+LNET_PID=12345
+LNET_PORTAL=42
+
+LNET_PREFIX="$LNET_IF:$LNET_PID:$LNET_PORTAL"
diff --git a/net/test/st/st-ping.sh b/net/test/st/st-ping.sh
index db617aa..635e59a 100755
--- a/net/test/st/st-ping.sh
+++ b/net/test/st/st-ping.sh
@@ -1,10 +1,12 @@
 #!/bin/sh
 
-source ./st-config-common.sh
+CWD=$(cd "$( dirname "$0")" && pwd)
+
+source $CWD/st-config.sh
 TEST_TYPE="ping"
 MSG_NR=1024
-MSG_SIZE="4k"
+MSG_SIZE=4k
 CONCURRENCY_CLIENT=8
 CONCURRENCY_SERVER=16
 
-source ./run-1x1.sh
+source $CWD/run-1x1.sh
diff --git a/net/test/st/st.sh b/net/test/st/st.sh
index 5770e88..168bc71 100755
--- a/net/test/st/st.sh
+++ b/net/test/st/st.sh
@@ -4,5 +4,7 @@
 # set -eux
 # export PS4='+ ${FUNCNAME[0]:+${FUNCNAME[0]}():}line ${LINENO}: '
 
-sh ./st-ping.sh
-sh ./st-bulk.sh
+CWD=$(cd "$( dirname "$0")" && pwd)
+
+sh $CWD/st-ping.sh
+SH $CWD/st-bulk.sh
-- 
1.8.3.2

