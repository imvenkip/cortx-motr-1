From 5d0b2ff2846eadb4bad60c53cff7670c0f679a7a Mon Sep 17 00:00:00 2001
From: Maxim Medved <Max_Medved@xyratex.com>
Date: Mon, 26 Nov 2012 06:42:36 +0200
Subject: [PATCH 21/58] LogD 1492: put magic values as first member in the
 struct

---
 net/test/node_bulk.c | 12 ++++++------
 net/test/node_ping.c |  4 ++--
 net/test/slist.c     |  4 ++--
 net/test/stats.h     |  4 ++--
 net/test/str.c       |  4 ++--
 5 files changed, 14 insertions(+), 14 deletions(-)

diff --git a/net/test/node_bulk.c b/net/test/node_bulk.c
index f4a25d0..ec9f443 100644
--- a/net/test/node_bulk.c
+++ b/net/test/node_bulk.c
@@ -116,6 +116,8 @@ struct buf_status_errno {
 
 /** Bulk transfer status */
 struct buf_status_bulk {
+	/** Magic for bsb_tlink */
+	uint64_t		bsb_magic;
 	/** State of bulk transfer */
 	enum transfer_state	bsb_ts;
 	/**
@@ -125,8 +127,6 @@ struct buf_status_bulk {
 	size_t			bsb_index;
 	/** Link for server_status_bulk.ssb_buffers */
 	struct c2_tlink		bsb_tlink;
-	/** Magic for bsb_tlink */
-	uint64_t		bsb_magic;
 	/** C2_NET_QT_MSG_SEND, C2_NET_QT_MSG_RECV functions and callbacks. */
 	struct buf_status_errno bsb_msg;
 	/**
@@ -152,6 +152,8 @@ struct buf_status_bulk {
 
 /** Buffer of message with bulk buffer network descriptors status */
 struct buf_status_ping {
+	/** Magic for bsp_tlink */
+	uint64_t	bsp_magic;
 	/** Ping buffer index */
 	size_t		bsp_index;
 	/**
@@ -162,18 +164,16 @@ struct buf_status_ping {
 	struct c2_tl	bsp_buffers;
 	/** Link for ping buffer list */
 	struct c2_tlink bsp_tlink;
-	/** Magic for bsp_tlink */
-	uint64_t	bsp_magic;
 };
 
 /** Server status for the test client */
 struct server_status_bulk {
+	/** Magic for ssb_tlink */
+	uint64_t	ssb_magic;
 	/** Server index */
 	size_t		ssb_index;
 	/** Link for list of servers */
 	struct c2_tlink ssb_tlink;
-	/** Magic for ssb_tlink */
-	uint64_t	ssb_magic;
 	/** List of queued buffers for this server */
 	struct c2_tl	ssb_buffers;
 };
diff --git a/net/test/node_ping.c b/net/test/node_ping.c
index c2d0617..496a14b 100644
--- a/net/test/node_ping.c
+++ b/net/test/node_ping.c
@@ -93,6 +93,8 @@ enum {
 
 /** Buffer state */
 struct buf_state {
+	/** Magic for messages timeout list */
+	uint64_t		   bs_link_magic;
 	/** Queue type */
 	enum c2_net_queue_type	   bs_q;
 	/**
@@ -126,8 +128,6 @@ struct buf_state {
 	size_t			   bs_index_pair;
 	/** Link for messages timeout list */
 	struct c2_tlink		   bs_link;
-	/** Magic for typed list */
-	uint64_t		   bs_link_magic;
 };
 
 C2_TL_DESCR_DEFINE(buf_state, "buf_state", static, struct buf_state, bs_link,
diff --git a/net/test/slist.c b/net/test/slist.c
index 8e1e1e2..81f4047 100644
--- a/net/test/slist.c
+++ b/net/test/slist.c
@@ -141,15 +141,15 @@ bool c2_net_test_slist_unique(const struct c2_net_test_slist *slist)
 }
 
 struct slist_params {
+	uint64_t sp_magic;	/**< SLIST_XCODE_MAGIC */
 	size_t   sp_nr;		/**< number if strings in the list */
 	size_t   sp_len;	/**< length of string array */
-	uint64_t sp_magic;	/**< SLIST_XCODE_MAGIC */
 };
 
 TYPE_DESCR(slist_params) = {
+	FIELD_DESCR(struct slist_params, sp_magic),
 	FIELD_DESCR(struct slist_params, sp_nr),
 	FIELD_DESCR(struct slist_params, sp_len),
-	FIELD_DESCR(struct slist_params, sp_magic),
 };
 
 static c2_bcount_t slist_encode(struct c2_net_test_slist *slist,
diff --git a/net/test/stats.h b/net/test/stats.h
index 3abbe24..e655c5b 100644
--- a/net/test/stats.h
+++ b/net/test/stats.h
@@ -203,12 +203,12 @@ c2_time_t c2_net_test_stats_time_max(struct c2_net_test_stats *stats);
    @{
  */
 struct c2_net_test_timestamp {
+	/** Magic. Checked when deserializing. */
+	uint64_t  ntt_magic;
 	/** Current time. Set in c2_net_test_timestamp_init() */
 	c2_time_t ntt_time;
 	/** Sequence number. */
 	uint64_t  ntt_seq;
-	/** Magic. Checked when deserializing. */
-	uint64_t  ntt_magic;
 };
 
 /**
diff --git a/net/test/str.c b/net/test/str.c
index 558576c..8c94e9b 100644
--- a/net/test/str.c
+++ b/net/test/str.c
@@ -41,13 +41,13 @@
  */
 
 struct net_test_str_len {
-	size_t   ntsl_len;
 	uint64_t ntsl_magic;
+	size_t   ntsl_len;
 };
 
 TYPE_DESCR(net_test_str_len) = {
-	FIELD_DESCR(struct net_test_str_len, ntsl_len),
 	FIELD_DESCR(struct net_test_str_len, ntsl_magic),
+	FIELD_DESCR(struct net_test_str_len, ntsl_len),
 };
 
 c2_bcount_t c2_net_test_str_serialize(enum c2_net_test_serialize_op op,
-- 
1.8.3.2

