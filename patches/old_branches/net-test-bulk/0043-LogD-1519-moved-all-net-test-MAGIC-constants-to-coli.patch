From 8f27541d29a1913000c00626acdaca64dfe0f89b Mon Sep 17 00:00:00 2001
From: Maxim Medved <Max_Medved@xyratex.com>
Date: Thu, 29 Nov 2012 17:16:21 +0200
Subject: [PATCH 43/58] LogD 1519: moved all net-test MAGIC constants to
 colibri/magic.h

---
 colibri/magic.h      | 39 +++++++++++++++++++++++++++++++++++++++
 net/test/network.c   |  7 ++-----
 net/test/node_bulk.c | 12 ++----------
 net/test/node_ping.c |  9 ++++-----
 net/test/slist.c     | 13 +++++--------
 net/test/stats.c     |  2 ++
 net/test/stats.h     |  7 +------
 net/test/str.c       |  3 +++
 net/test/str.h       |  5 -----
 net/test/ut/stats.c  |  2 ++
 10 files changed, 60 insertions(+), 39 deletions(-)

diff --git a/colibri/magic.h b/colibri/magic.h
index ea2e338..4fd7781 100755
--- a/colibri/magic.h
+++ b/colibri/magic.h
@@ -290,6 +290,45 @@ enum c2_magic_satchel {
 	/* nlx_xo_ep::xe_magic (failed fiasco) */
 	C2_NET_LNET_XE_MAGIC = 0x33fa11edf1a5c077,
 
+	/* bsb_tl::tl_head_magic (collides lail) */
+	C2_NET_TEST_BSB_HEAD_MAGIC = 0x33c0111de51a1177,
+
+	/* buf_status_bulk::bsb_magic (colloidal dal) */
+	C2_NET_TEST_BSB_MAGIC = 0x33c01101da1da177,
+
+	/* bsp_tl::tl_head_magic (delocalize so) */
+	C2_NET_TEST_BSP_HEAD_MAGIC = 0x33de10ca112e5077,
+
+	/* buf_status_ping::bsp_magic (lossless bafo) */
+	C2_NET_TEST_BSP_MAGIC = 0x3310551e55baf077,
+
+	/* buf_state_tl::tl_head_magic (official oecd) */
+	C2_NET_TEST_BS_HEAD_MAGIC = 0x330ff1c1a10ecd77,
+
+	/* buf_state::bs_link_magic (decibel aedes) */
+	C2_NET_TEST_BS_LINK_MAGIC = 0x33dec1be1aede577,
+
+	/* net_test_network_bds_header::ntnbh_magic (boldfaces esd) */
+	C2_NET_TEST_NETWORK_BDS_MAGIC = 0x33b01dface5e5d77,
+
+	/* net_test_network_bd::ntnbd_magic (socialized io) */
+	C2_NET_TEST_NETWORK_BD_MAGIC = 0x3350c1a112ed1077,
+
+	/* slist_params::sp_magic (sodaless adze) */
+	C2_NET_TEST_SLIST_MAGIC = 0x3350da1e55ad2e77,
+
+	/* ssb_tl::tl_head_magic (coloss caball) */
+	C2_NET_TEST_SSB_HEAD_MAGIC = 0x33c01055caba1177,
+
+	/* server_status_bulk::ssb_magic (closes doddie) */
+	C2_NET_TEST_SSB_MAGIC = 0x33c105e5d0dd1e77,
+
+	/* net_test_str_len::ntsl_magic (boldfaced sao) */
+	C2_NET_TEST_STR_MAGIC = 0x33b01dfaced5a077,
+
+	/* c2_net_test_timestamp::ntt_magic (allied cabiai) */
+	C2_NET_TEST_TIMESTAMP_MAGIC = 0x33a111edcab1a177,
+
 /* Request handler */
 	/* c2_reqh_service::rs_magix (bacilli babel) */
 	C2_REQH_SVC_MAGIC = 0x33bac1111babe177,
diff --git a/net/test/network.c b/net/test/network.c
index f3c8114..5ece23a 100644
--- a/net/test/network.c
+++ b/net/test/network.c
@@ -31,6 +31,8 @@
 #include "lib/misc.h"		/* C2_SET0 */
 #include "lib/vec.h"		/* C2_SEG_SHIFT */
 
+#include "colibri/magic.h"	/* C2_NET_TEST_NETWORK_BD_MAGIC */
+
 #include "net/net.h"
 #include "net/lnet/lnet.h"	/* c2_net_lnet_xprt */
 
@@ -56,11 +58,6 @@
 #endif
 #endif
 
-enum {
-	C2_NET_TEST_NETWORK_BD_MAGIC = 1,	/** @todo fix */
-	C2_NET_TEST_NETWORK_BDS_MAGIC = 2,
-};
-
 int c2_net_test_network_init(void)
 {
 	return c2_net_xprt_init(&c2_net_lnet_xprt);
diff --git a/net/test/node_bulk.c b/net/test/node_bulk.c
index 40a3b89..939b34f 100644
--- a/net/test/node_bulk.c
+++ b/net/test/node_bulk.c
@@ -25,6 +25,8 @@
 #include "lib/trace.h"			/* C2_LOG */
 #include "lib/misc.h"			/* C2_IN */
 
+#include "colibri/magic.h"		/* C2_NET_TEST_BSB_MAGIC */
+
 #include "net/test/network.h"		/* c2_net_test_network_ctx */
 #include "net/test/node.h"		/* c2_net_test_node_ctx */
 #include "net/test/node_helper.h"	/* c2_net_test_node_ctx */
@@ -96,16 +98,6 @@ enum transfer_state {
 	TS_TRANSFERRED,		/**< client & server state */
 };
 
-enum {
-	C2_NET_TEST_BSB_MAGIC = 3,	/** @todo FIXME */
-	C2_NET_TEST_BSB_HEAD_MAGIC = 4,	/** @todo FIXME */
-	C2_NET_TEST_SSB_MAGIC = 3,	/** @todo FIXME */
-	C2_NET_TEST_SSB_HEAD_MAGIC = 4,	/** @todo FIXME */
-	C2_NET_TEST_BSP_MAGIC = 3,	/** @todo FIXME */
-	C2_NET_TEST_BSP_HEAD_MAGIC = 4,	/** @todo FIXME */
-
-};
-
 /**
  * Return values for network operations.
  * @todo add timestamp
diff --git a/net/test/node_ping.c b/net/test/node_ping.c
index 45455e2..fc2e41c 100644
--- a/net/test/node_ping.c
+++ b/net/test/node_ping.c
@@ -40,6 +40,8 @@
 #include "lib/thread.h"			/* C2_THREAD_INIT */
 #include "lib/tlist.h"			/* c2_tlist */
 
+#include "colibri/magic.h"		/* C2_NET_TEST_BS_LINK_MAGIC */
+
 #include "net/test/network.h"		/* c2_net_test_network_ctx */
 #include "net/test/node.h"		/* c2_net_test_node_ctx */
 #include "net/test/node_helper.h"	/* c2_net_test_node_ctx */
@@ -83,10 +85,6 @@
  */
 
 enum {
-	/** @todo change after merging to master and move to lib/magic.h */
-	BS_LINK_MAGIC	  = 0x1213141516,
-	/** @todo change after merging to master and move to lib/magic.h */
-	BS_HEAD_MAGIC	  = 0x1718191A1B,
 	/** Timeout checking interval, ms */
 	TO_CHECK_INTERVAL = 10,
 };
@@ -131,7 +129,8 @@ struct buf_state {
 };
 
 C2_TL_DESCR_DEFINE(buf_state, "buf_state", static, struct buf_state, bs_link,
-		   bs_link_magic, BS_LINK_MAGIC, BS_HEAD_MAGIC);
+		   bs_link_magic, C2_NET_TEST_BS_LINK_MAGIC,
+		   C2_NET_TEST_BS_HEAD_MAGIC);
 C2_TL_DEFINE(buf_state, static, struct buf_state);
 
 /**
diff --git a/net/test/slist.c b/net/test/slist.c
index 7a3a0f8..70b750b 100644
--- a/net/test/slist.c
+++ b/net/test/slist.c
@@ -22,6 +22,8 @@
 #include "lib/memory.h"		/* C2_ALLOC_ARR */
 #include "lib/errno.h"		/* ENOMEM */
 
+#include "colibri/magic.h"	/* C2_NET_TEST_SLIST_MAGIC */
+
 #include "net/test/slist.h"
 
 /**
@@ -31,11 +33,6 @@
    @{
  */
 
-enum {
-	/** NT_SLIST @todo move to lib/magic.h */
-	SLIST_SERIALIZE_MAGIC =  0x5453494C535F544E,
-};
-
 static bool slist_alloc(struct c2_net_test_slist *slist,
 		        size_t string_nr,
 		        size_t arr_len)
@@ -141,7 +138,7 @@ bool c2_net_test_slist_unique(const struct c2_net_test_slist *slist)
 }
 
 struct slist_params {
-	uint64_t sp_magic;	/**< SLIST_XCODE_MAGIC */
+	uint64_t sp_magic;	/**< C2_NET_TEST_SLIST_MAGIC */
 	size_t   sp_nr;		/**< number if strings in the list */
 	size_t   sp_len;	/**< length of string array */
 };
@@ -165,7 +162,7 @@ static c2_bcount_t slist_encode(struct c2_net_test_slist *slist,
 		      slist->ntsl_list[slist->ntsl_nr - 1] -
 		      slist->ntsl_list[0] +
 		      strlen(slist->ntsl_list[slist->ntsl_nr - 1]) + 1;
-	sp.sp_magic = SLIST_SERIALIZE_MAGIC;
+	sp.sp_magic = C2_NET_TEST_SLIST_MAGIC;
 
 	len = c2_net_test_serialize(C2_NET_TEST_SERIALIZE, &sp,
 				    USE_TYPE_DESCR(slist_params), bv, offset);
@@ -194,7 +191,7 @@ static c2_bcount_t slist_decode(struct c2_net_test_slist *slist,
 	len = c2_net_test_serialize(C2_NET_TEST_DESERIALIZE, &sp,
 				    USE_TYPE_DESCR(slist_params),
 				    bv, offset);
-	if (len == 0 || sp.sp_magic != SLIST_SERIALIZE_MAGIC)
+	if (len == 0 || sp.sp_magic != C2_NET_TEST_SLIST_MAGIC)
 		return 0;
 	len_total = net_test_accumulate_len(0, len);
 
diff --git a/net/test/stats.c b/net/test/stats.c
index b9c6422..c7e3f13 100644
--- a/net/test/stats.c
+++ b/net/test/stats.c
@@ -27,6 +27,8 @@
 #include "lib/misc.h"		/* C2_SET0 */
 #include "lib/arith.h"		/* min_check */
 
+#include "colibri/magic.h"	/* C2_NET_TEST_TIMESTAMP_MAGIC */
+
 #include "net/test/stats.h"
 
 /**
diff --git a/net/test/stats.h b/net/test/stats.h
index e655c5b..cca4cf0 100644
--- a/net/test/stats.h
+++ b/net/test/stats.h
@@ -76,11 +76,6 @@
    @{
  */
 
-enum {
-	/** NT_TIMES @todo move to lib/magic.h */
-	C2_NET_TEST_TIMESTAMP_MAGIC = 0x53454d49545f544e,
-};
-
 /**
    This structure is used for statistics calculation and collecting.
    Min and max stored directly in this structure, average and
@@ -203,7 +198,7 @@ c2_time_t c2_net_test_stats_time_max(struct c2_net_test_stats *stats);
    @{
  */
 struct c2_net_test_timestamp {
-	/** Magic. Checked when deserializing. */
+	/** C2_NET_TEST_TIMESTAMP_MAGIC */
 	uint64_t  ntt_magic;
 	/** Current time. Set in c2_net_test_timestamp_init() */
 	c2_time_t ntt_time;
diff --git a/net/test/str.c b/net/test/str.c
index ee3eaf4..81b06fd 100644
--- a/net/test/str.c
+++ b/net/test/str.c
@@ -26,6 +26,8 @@
 
 #include "lib/memory.h"		/* c2_alloc */
 
+#include "colibri/magic.h"	/* C2_NET_TEST_STR_MAGIC */
+
 #include "net/test/str.h"
 
 /**
@@ -39,6 +41,7 @@
  */
 
 struct net_test_str_len {
+	/** C2_NET_TEST_STR_MAGIC */
 	uint64_t ntsl_magic;
 	size_t   ntsl_len;
 };
diff --git a/net/test/str.h b/net/test/str.h
index 08583d7..6f91d93 100644
--- a/net/test/str.h
+++ b/net/test/str.h
@@ -36,11 +36,6 @@
    @{
  */
 
-enum {
-	/** NTSTRING @todo move to lib/magic.h */
-	C2_NET_TEST_STR_MAGIC = 0x474e49525453544e,
-};
-
 /**
    Serialize or deserialize ASCIIZ string.
    @pre op == C2_NET_TEST_SERIALIZE || op == C2_NET_TEST_DESERIALIZE
diff --git a/net/test/ut/stats.c b/net/test/ut/stats.c
index 6dffbbe..453b5e8 100644
--- a/net/test/ut/stats.c
+++ b/net/test/ut/stats.c
@@ -29,6 +29,8 @@
 #include "lib/misc.h"		/* C2_SET0 */
 #include "lib/ut.h"		/* C2_UT_ASSERT */
 
+#include "colibri/magic.h"	/* C2_NET_TEST_TIMESTAMP_MAGIC */
+
 #include "net/test/stats.h"
 
 enum {
-- 
1.8.3.2

