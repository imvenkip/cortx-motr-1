From 5af0a828eaa9bdddd66d1dfad05e2882803ad2a6 Mon Sep 17 00:00:00 2001
From: Rajanikant Chirmade <rajanikant_chirmade@xyratex.com>
Date: Thu, 6 Feb 2014 13:11:18 +0530
Subject: [PATCH 17/50]  - defined M0_FOM_SM_STATS_HISTS_ARGS

---
 fop/fom.h                   | 10 +++-------
 fop/fop_addb.h              |  5 -----
 fop/ut/stats/stats_fom.c    |  5 -----
 ioservice/io_service_addb.h |  6 ------
 4 files changed, 3 insertions(+), 23 deletions(-)

diff --git a/fop/fom.h b/fop/fom.h
index 641aa2d..6be2017 100644
--- a/fop/fom.h
+++ b/fop/fom.h
@@ -385,17 +385,13 @@ enum { M0_FOS_TRANS_NR = 8 };
  *       May differentiate it later if required.
  */
 #undef M0_FOM_SM_STATS_HIST_ARGS
-
-#ifdef M0_FOM_SM_STATS_HIST_ARGS
+#define M0_FOM_SM_STATS_HIST_ARGS 100
 #define M0_FOM_SM_STATS_HIST_ARGS2 0, M0_FOM_SM_STATS_HIST_ARGS
-#else
-#define M0_FOM_SM_STATS_HIST_ARGS2
-#endif
 
 #define M0_FOM_STATS_CNTR_DATA						\
 	(sizeof(struct m0_addb_counter_data) +				\
-	((M0_COUNT_PARAMS(M0_FOM_STATE_STATS_HIST_ARGS2) > 0 ?		\
-	  M0_COUNT_PARAMS(M0_FOM_STATE_STATS_HIST_ARGS2) + 1 : 0) *	\
+	((M0_COUNT_PARAMS(M0_FOM_SM_STATS_HIST_ARGS2) > 0 ?		\
+	  M0_COUNT_PARAMS(M0_FOM_SM_STATS_HIST_ARGS2) + 1 : 0) *	\
                   sizeof(uint64_t)))
 enum {
 	FOM_STATE_STATS_DATA_SZ = M0_FOM_STATS_CNTR_DATA * M0_FOS_TRANS_NR
diff --git a/fop/fop_addb.h b/fop/fop_addb.h
index b46cf79..3755c08 100644
--- a/fop/fop_addb.h
+++ b/fop/fop_addb.h
@@ -118,14 +118,9 @@ M0_ADDB_RT_DP(m0_addb_rt_fom_fini, M0_ADDB_RECID_FOM_FINI, "transitions");
 
 extern struct m0_sm_conf fom_states_conf;
 
-#ifdef M0_FOM_SM_STATS_HIST_ARGS
 /** FOM state statistics counter */
 M0_ADDB_RT_SM_CNTR(m0_addb_rt_fom_state_stats, M0_ADDB_RECID_FOM_STATE_STATS,
 		   &fom_states_conf, M0_FOM_SM_STATS_HIST_ARGS);
-#else
-M0_ADDB_RT_SM_CNTR(m0_addb_rt_fom_state_stats, M0_ADDB_RECID_FOM_STATE_STATS,
-		   &fom_states_conf);
-#endif
 
 /**
  * Accumulated run time of all locality foms (in "binary" usec).
diff --git a/fop/ut/stats/stats_fom.c b/fop/ut/stats/stats_fom.c
index 6aaa94b..511ff14 100644
--- a/fop/ut/stats/stats_fom.c
+++ b/fop/ut/stats/stats_fom.c
@@ -58,13 +58,8 @@ static struct m0_sm_conf fom_phases_conf = {
 	.scf_trans     = trans
 };
 
-#ifdef M0_FOM_SM_STATS_HIST_ARGS
 M0_ADDB_RT_SM_CNTR(addb_rt_fom_phase_stats, ADDB_RECID_FOM_PHASE_STATS,
 		   &fom_phases_conf, M0_FOM_SM_STATS_HIST_ARGS);
-#else
-M0_ADDB_RT_SM_CNTR(addb_rt_fom_phase_stats, ADDB_RECID_FOM_PHASE_STATS,
-		   &fom_phases_conf);
-#endif
 
 static size_t fom_stats_home_locality(const struct m0_fom *fom);
 static void fop_stats_fom_fini(struct m0_fom *fom);
diff --git a/ioservice/io_service_addb.h b/ioservice/io_service_addb.h
index a986aca..11bd8dc 100644
--- a/ioservice/io_service_addb.h
+++ b/ioservice/io_service_addb.h
@@ -200,16 +200,10 @@ enum {
 
 extern struct m0_addb_ctx m0_ios_addb_ctx;
 extern struct m0_sm_conf io_conf;
-#ifdef M0_FOM_SM_STATS_HIST_ARGS
 /** FOM state statistics counter */
 M0_ADDB_RT_SM_CNTR(m0_addb_rt_ios_io_fom_phase_stats,
 		   M0_ADDB_RECID_IOS_IO_FOM_PHASE_STATS,
 		   &io_conf, M0_FOM_SM_STATS_HIST_ARGS);
-#else
-M0_ADDB_RT_SM_CNTR(m0_addb_rt_ios_io_fom_phase_stats,
-		   M0_ADDB_RECID_IOS_IO_FOM_PHASE_STATS,
-		   &io_conf);
-#endif
 
 /* Total time required and size for IO */
 M0_ADDB_RT_DP(m0_addb_rt_ios_io_finish, M0_ADDB_RECID_IOS_IO_FINISH,
-- 
1.8.3.2

