From b295f02e40618dbca66ba2bb5790476ccf5adebb Mon Sep 17 00:00:00 2001
From: Anatoliy Bilenko <anatoliy_bilenko@xyratex.com>
Date: Wed, 29 Jan 2014 10:40:54 +0200
Subject: [PATCH 1/9] seg0: added metadata dld draft.

---
 be/seg.h | 73 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 73 insertions(+)

diff --git a/be/seg.h b/be/seg.h
index b5265d6..7a4b995 100644
--- a/be/seg.h
+++ b/be/seg.h
@@ -161,5 +161,78 @@ M0_INTERNAL int m0_be_seg__write(struct m0_be_reg *reg, void *src);
 M0_INTERNAL int m0_be_reg__read(struct m0_be_reg *reg);
 M0_INTERNAL int m0_be_reg__write(struct m0_be_reg *reg);
 
+/**
+ * Dependencies.
+ * @dot
+ *  digraph conf_fetch_phase {
+ *      node [fontsize=9];
+ *      edge [fontsize=9];
+ *      "M0_BE:SEG0"    [shape=rect, style=filled, fillcolor=lightgrey];
+ *      "M0_BE:SEG1"    [shape=rect, style=filled, fillcolor=lightgrey];
+ *      "M0_BE:SEG2"    [shape=rect, style=filled, fillcolor=lightgrey];
+ *      "M0_BE:SEGN"    [shape=rect, style=filled, fillcolor=lightgrey];
+ *      "M0_BE:COB1"    [shape=rect, style=filled, fillcolor=lightgrey];
+ *      "M0_BE:COB0"    [shape=rect, style=filled, fillcolor=lightgrey];
+ *      "M0_BE:MDS"     [shape=rect, style=filled, fillcolor=lightgrey];
+ *      "M0_BE:AD0"     [shape=rect, style=filled, fillcolor=lightgrey];
+ *      "M0_BE:AD1"     [shape=rect, style=filled, fillcolor=lightgrey];
+ *      "M0_BE:BALLOC0" [shape=rect, style=filled, fillcolor=lightgrey];
+ *      "M0_BE:BALLOC1" [shape=rect, style=filled, fillcolor=lightgrey];
+ *
+ *      "M0_BE:SEG0" -> "M0_BE:SEG1"
+ *      "M0_BE:SEG0" -> "M0_BE:SEG2"
+ *      "M0_BE:SEG0" -> "M0_BE:SEGN"
+ *      "M0_BE:SEG1" -> "M0_BE:COB0"
+ *      "M0_BE:SEG2" -> "M0_BE:COB0"
+ *      "M0_BE:SEG2" -> "M0_BE:COB1"
+ *      "M0_BE:COB1" -> "M0_BE:MDS"
+ *      "M0_BE:COB0" -> "M0_BE:MDS"
+ *      "M0_BE:SEGN" -> "M0_BE:AD0"
+ *      "M0_BE:SEGN" -> "M0_BE:AD1"
+ *      "M0_BE:AD1"  -> "M0_BE:BALLOC0"
+ *      "M0_BE:AD0"  -> "M0_BE:BALLOC1"
+ *  }
+ * @enddot
+ *
+ * Startup.
+ *
+ * @code
+ * struct m0_be_segobj_desc *desc;
+ * enum m0_be_segobj_type    objtype;
+ *
+ * for (objtype = 0; objtype < M0_BST_NR; ++objtype) {
+ * 	for (desc = segobj_desc_begin(dict, objtype);
+ * 	     desc != NULL; desc = segobj_desc_next(dict, objtype))
+ * 		be_obj_up(desc);
+ * }
+ * @endcode
+ */
+
+enum m0_be_segobj_type {
+	M0_BST_SEG,
+	M0_BST_AD,
+	M0_BST_COB,
+	M0_BST_MD,
+	M0_BST_BALLOC,
+	M0_BST_NR,
+};
+
+struct m0_be_segobj_opts {
+	union {
+		struct { /* segment options */
+		} seg;
+		struct { /* mds options */
+		} mds;
+		struct { /* ad options */
+		} ad;
+	} so_u;
+};
+
+struct m0_be_segobj_desc {
+	enum m0_be_segobj_type   sd_type;
+	struct m0_be_segobj_opts sd_opts;
+};
+
+
 /** @} end of be group */
 #endif /* __MERO_BE_SEG_H__ */
-- 
1.8.3.2

