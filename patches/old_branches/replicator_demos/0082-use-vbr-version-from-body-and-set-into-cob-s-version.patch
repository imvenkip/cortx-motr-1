From 9cad7d7efc0b5684d244b2af91af9d33ace85804 Mon Sep 17 00:00:00 2001
From: Yuriy Umanets <yuriy_umanets@xyratex.com>
Date: Fri, 6 May 2011 02:28:42 -0600
Subject: [PATCH 82/91] - use vbr version from body and set into cob's version
 fabrec field.

---
 mdservice/md_fops.ff | 1 +
 mdstore/mdstore.c    | 3 +++
 2 files changed, 4 insertions(+)

diff --git a/mdservice/md_fops.ff b/mdservice/md_fops.ff
index bf160a1..85cf72c 100644
--- a/mdservice/md_fops.ff
+++ b/mdservice/md_fops.ff
@@ -21,6 +21,7 @@ DEF(c2_fop_name, SEQUENCE,
 
 DEF(c2_fop_cob, RECORD,
     _(b_index, U64),
+    _(b_version, U64),
     _(b_flags, U32),
     _(b_mode, U32),
     _(b_size, U64),
diff --git a/mdstore/mdstore.c b/mdstore/mdstore.c
index c05d054..6233f41 100644
--- a/mdstore/mdstore.c
+++ b/mdstore/mdstore.c
@@ -213,6 +213,9 @@ int c2_md_store_create(struct c2_md_store       *md,
         omgrec.cor_uid = body->b_uid;
         omgrec.cor_gid = body->b_gid;
         omgrec.cor_mode = body->b_mode;
+        
+        /* @todo: fol ref component should also be initialized. */
+        fabrec.cfb_version.vn_vc = body->b_version;
 
         rc = c2_md_store_create_attr(md, pcob, cob, nskey, &nsrec, &fabrec, 
                                      &omgrec, &ctx->fc_tx->tx_dbtx);
-- 
1.8.3.2

