From ea559ebac3862646a8a271c099636ef33f98a824 Mon Sep 17 00:00:00 2001
From: Andriy Tkachuk <andriy_tkachuk@xyratex.com>
Date: Tue, 11 Feb 2014 17:15:05 +0200
Subject: [PATCH 40/60] rpc-item-ut fixed: M0_RPC_ITEM_RESEND_INTERVAL used

---
 rpc/rpc.c        | 3 ++-
 ut/cs_fop_foms.c | 6 +++---
 2 files changed, 5 insertions(+), 4 deletions(-)

diff --git a/rpc/rpc.c b/rpc/rpc.c
index cf05f34..2e837b8 100644
--- a/rpc/rpc.c
+++ b/rpc/rpc.c
@@ -217,7 +217,8 @@ int m0_rpc_reply_post(struct m0_rpc_item *request, struct m0_rpc_item *reply)
 
 	if (M0_FI_ENABLED("delay_reply")) {
 		M0_LOG(M0_DEBUG, "%p reply delayed", request);
-		m0_nanosleep(m0_time(1, 200 * 1000 * 1000), NULL);
+		m0_nanosleep(m0_time(M0_RPC_ITEM_RESEND_INTERVAL,
+				     200 * 1000 * 1000), NULL);
 	}
 
 	reply->ri_resend_interval = M0_TIME_NEVER;
diff --git a/ut/cs_fop_foms.c b/ut/cs_fop_foms.c
index d109240..33008c2 100644
--- a/ut/cs_fop_foms.c
+++ b/ut/cs_fop_foms.c
@@ -298,9 +298,9 @@ static int cs_req_fop_fom_tick(struct m0_fom *fom)
 			break;
 		}
 	}
-	if (M0_FI_ENABLED("inject_delay")) {
-		m0_nanosleep(m0_time(2, 0), NULL);
-	}
+	if (M0_FI_ENABLED("inject_delay"))
+		m0_nanosleep(m0_time(M0_RPC_ITEM_RESEND_INTERVAL +1, 0), NULL);
+
 	return rc;
 }
 
-- 
1.8.3.2

