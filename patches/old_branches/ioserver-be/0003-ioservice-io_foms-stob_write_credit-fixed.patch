From 7ea3469b0e9d4f073a3450d8efe1acee1515ec2f Mon Sep 17 00:00:00 2001
From: Andriy Tkachuk <andriy_tkachuk@xyratex.com>
Date: Tue, 24 Sep 2013 17:25:31 +0300
Subject: [PATCH 3/7] ioservice/io_foms: stob_write_credit() fixed

Blocks counter was not zeroed and had garbage value.
---
 ioservice/io_foms.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/ioservice/io_foms.c b/ioservice/io_foms.c
index 5914ef4..8c33052 100644
--- a/ioservice/io_foms.c
+++ b/ioservice/io_foms.c
@@ -1728,7 +1728,7 @@ static void stob_write_credit(struct m0_fom *fom)
 	struct m0_fop_cob_rw	*rwfop;
 	struct m0_io_indexvec    wire_ivec;
 	struct m0_stob_domain	*fom_stdom;
-	m0_bcount_t		 count;
+	m0_bcount_t		 count = 0;
 	int			 i;
 	int			 j;
 
@@ -1756,6 +1756,7 @@ static void stob_write_credit(struct m0_fom *fom)
 		for (j = 0; j < wire_ivec.ci_nr; j++)
 			count += wire_ivec.ci_iosegs[j].ci_count >> bshift;
 	}
+	M0_LOG(M0_DEBUG, "blocks=%d", (int)count);
 	m0_stob_write_credit(fom_stdom, count, &fom->fo_tx.tx_betx_cred);
 }
 
-- 
1.8.3.2

