From adfd52cde13e90ac5e1bde61869cb5acdbea9df2 Mon Sep 17 00:00:00 2001
From: Yuriy Umanets <yuriy_umanets@xyratex.com>
Date: Wed, 2 Apr 2014 00:04:30 +0400
Subject: [PATCH 06/13] - added obf test

---
 m0t1fs/linux_kernel/st/m0t1fs_client_inc.sh | 18 ++++++++++++++++++
 1 file changed, 18 insertions(+)

diff --git a/m0t1fs/linux_kernel/st/m0t1fs_client_inc.sh b/m0t1fs/linux_kernel/st/m0t1fs_client_inc.sh
index 5df2208..bbf8456 100644
--- a/m0t1fs/linux_kernel/st/m0t1fs_client_inc.sh
+++ b/m0t1fs/linux_kernel/st/m0t1fs_client_inc.sh
@@ -468,8 +468,26 @@ rmw_test()
 	return 0
 }
 
+obf_test()
+{
+        stat $MERO_M0T1FS_MOUNT_DIR/.mero || return 1
+        ls -la $MERO_M0T1FS_MOUNT_DIR/.mero || return 1
+        stat $MERO_M0T1FS_MOUNT_DIR/.mero/fid || return 1
+        ls -la $MERO_M0T1FS_MOUNT_DIR/.mero/fid || return 1
+        touch $MERO_M0T1FS_MOUNT_DIR/file0 || return 1
+        stat $MERO_M0T1FS_MOUNT_DIR/.mero/fid/0:6 || return 1
+        ls -la $MERO_M0T1FS_MOUNT_DIR/.mero/fid/0:6 || return 1
+
+        return 0
+}
+
 m0t1fs_system_tests()
 {
+        obf_test || {
+		echo "Failed: Open-by-fid test failed."
+		return 1
+        }
+
 	file_creation_test $MAX_NR_FILES || {
 		echo "Failed: File creation test failed."
 		return 1
-- 
1.8.3.2

