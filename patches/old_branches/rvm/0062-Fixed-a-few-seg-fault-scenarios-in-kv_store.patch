From 567dcaca1d675524e34812b05b95df5b26c1752d Mon Sep 17 00:00:00 2001
From: Zishan Shaikh <zishan_shaikh@xyratex.com>
Date: Fri, 8 Mar 2013 04:29:38 -0800
Subject: [PATCH 062/121] Fixed a few seg fault scenarios in kv_store

---
 be/kv_store.c | 9 ++++-----
 1 file changed, 4 insertions(+), 5 deletions(-)

diff --git a/be/kv_store.c b/be/kv_store.c
index e0ca507..e377cdd 100644
--- a/be/kv_store.c
+++ b/be/kv_store.c
@@ -188,13 +188,12 @@ M0_INTERNAL void m0_be_ks_init(struct m0_be_kv_store     *handle,
 
                 bko_cbinfo->ksc_cb     = cb_info->ksc_cb;
                 bko_cbinfo->ksc_cbdata = cb_info->ksc_cbdata;
-
-                bk_opdata->bko_cbinfo = bko_cbinfo;
+                bk_opdata->bko_cbinfo  = bko_cbinfo;
         }
         else {
                 /* Assures bko_cbinfo won't contain garbage info */
-                bk_opdata->bko_cbinfo->ksc_cbdata = NULL;
-                bk_opdata->bko_cbinfo->ksc_cb     = NULL;
+                bk_opdata->bko_cbinfo = NULL;
+                bk_opdata->bko_cbinfo = NULL;
         }
 
         m0_sm_enqueue_post(sm_group, bk_opdata, m0_be_ksi_handle_cb);
@@ -783,7 +782,7 @@ M0_INTERNAL void m0_be_ksi_init_done(void *cb_data)
         handle = bk_opdata->bko_handle;
         dom    = handle->ks_handle_heap.ksh_dom;
 
-        if (bk_opdata->bko_cbinfo->ksc_cbdata != NULL)
+        if (bk_opdata->bko_cbinfo != NULL)
                 cb_info = bk_opdata->bko_cbinfo;
         else
                 cb_info = NULL;
-- 
1.8.3.2

