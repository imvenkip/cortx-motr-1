From a020f65faca0b6c40eaef5a72f8e2e91e2b2acd2 Mon Sep 17 00:00:00 2001
From: "Valery V. Vorotyntsev" <valery_vorotyntsev@xyratex.com>
Date: Wed, 4 Jul 2012 15:10:57 +0300
Subject: [PATCH 217/311] have c2_conf_obj::co_magix instead of per-object
 fields

+ Clean documentation of c2_conf_obj::co_confc.
---
 conf/obj.h | 23 ++++++++---------------
 1 file changed, 8 insertions(+), 15 deletions(-)

diff --git a/conf/obj.h b/conf/obj.h
index 5b686ff..f7fb3f6 100644
--- a/conf/obj.h
+++ b/conf/obj.h
@@ -184,6 +184,13 @@ struct c2_conf_obj {
 	/** Type of the ambient concrete configuration object. */
 	enum c2_conf_objtype          co_type;
 	/**
+	 * Magic value.
+	 *
+	 * Different magic values are used for different concrete
+	 * object types.
+	 */
+	uint64_t                      co_magix;
+	/**
 	 * Object identifier.
 	 * This value is unique among the object of given ->co_type.
 	 */
@@ -209,13 +216,7 @@ struct c2_conf_obj {
 	struct c2_chan                co_chan;
 	/**
 	 * Private data of confc implementation.
-	 *
-	 * If confd implementation ever needs to store its private
-	 * data within c2_conf_obj, this member should be changed to
-	 * union {
-	 *         struct c2_confc *confc;
-	 *         some_type       *confd;
-	 * } co_private;
+	 * NULL at confd side.
 	 */
 	struct c2_confc              *co_confc;
 };
@@ -241,7 +242,6 @@ struct c2_conf_obj {
  */
 struct c2_conf_dir {
 	struct c2_conf_obj   cd_obj;
-	uint64_t             cd_magix;
 	struct c2_tl         cd_items;
 	/**
 	 * Type of items.
@@ -258,13 +258,11 @@ struct c2_conf_profile {
 	 * object in a DAG of configuration objects.
 	 */
 	struct c2_conf_obj         cp_obj;
-	uint64_t                   cp_magix;
 	struct c2_conf_filesystem *cp_filesystem;
 };
 
 struct c2_conf_filesystem {
 	struct c2_conf_obj  cf_obj;
-	uint64_t            cf_magix;
 	struct c2_conf_dir *cf_services;
 /* configuration data (for the application) */
 	struct c2_fid       cf_rootfid;
@@ -278,7 +276,6 @@ struct c2_conf_filesystem {
 
 struct c2_conf_service {
 	struct c2_conf_obj       cs_obj;
-	uint64_t                 cs_magix;
 	/** The node this service is hosted at. */
 	struct c2_conf_node     *cs_node;
 	/**
@@ -301,7 +298,6 @@ struct c2_conf_node {
 	 * several services, so there may be no single parent.
 	 */
 	struct c2_conf_obj  cn_obj;
-	uint64_t            cn_magix;
 	struct c2_conf_dir *cn_nics;
 	struct c2_conf_dir *cn_sdevs;
 /* configuration data (for the application) */
@@ -315,7 +311,6 @@ struct c2_conf_node {
 /** Network interface controller. */
 struct c2_conf_nic {
 	struct c2_conf_obj ni_obj;
-	uint64_t           ni_magix;
 	/**
 	 * Linkage to ->cd_items of the c2_conf_dir hanging from
 	 * c2_conf_node::cn_nics.
@@ -332,7 +327,6 @@ struct c2_conf_nic {
 /** Storage device. */
 struct c2_conf_sdev {
 	struct c2_conf_obj  sd_obj;
-	uint64_t            sd_magix;
 	struct c2_conf_dir *sd_partitions;
 	/**
 	 * Linkage to ->cd_items of the c2_conf_dir hanging from
@@ -351,7 +345,6 @@ struct c2_conf_sdev {
 /** Storage device partition. */
 struct c2_conf_partition {
 	struct c2_conf_obj pa_obj;
-	uint64_t           pa_magix;
 	/**
 	 * Linkage to ->cd_items of the c2_conf_dir hanging from
 	 * c2_conf_sdev::sd_partitions.
-- 
1.8.3.2

