From 31ccde0a2a37a5506527aa61713c62368539d4f9 Mon Sep 17 00:00:00 2001
From: "Valery V. Vorotyntsev" <valery_vorotyntsev@xyratex.com>
Date: Wed, 4 Jul 2012 21:01:20 +0300
Subject: [PATCH 219/311] c2_confc_ctx_handout(): use C2_IN() for the
 precondition

Nice macro.

LogD #265
RB: r/865
---
 conf/confc.c | 3 +++
 conf/confc.h | 2 +-
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/conf/confc.c b/conf/confc.c
index 9843f93..cda9db9 100644
--- a/conf/confc.c
+++ b/conf/confc.c
@@ -25,6 +25,7 @@
 #include "conf/preload.h"  /* c2_conf_parse */
 #include "lib/cdefs.h"     /* C2_HAS_TYPE, equi */
 #include "lib/arith.h"     /* C2_CNT_INC, C2_CNT_DEC */
+#include "lib/misc.h"      /* C2_IN */
 
 /**
  * @page confc-lspec confc Internals
@@ -442,6 +443,8 @@ void c2_confc_ctx_fini(struct c2_confc_ctx *ctx)
 
 struct c2_conf_obj *c2_confc_ctx_handout(struct c2_confc_ctx *ctx)
 {
+	C2_PRE(C2_IN(ctx->fc_mach, (S_TERMINAL, S_FAILURE)));
+
 	XXX;
 }
 
diff --git a/conf/confc.h b/conf/confc.h
index b7fe5b0..dd38fbc 100644
--- a/conf/confc.h
+++ b/conf/confc.h
@@ -461,7 +461,7 @@ void c2_confc_ctx_fini(struct c2_confc_ctx *ctx);
 /**
  * Sets c2_confc_ctx::fc_result to NULL and returns the original value.
  *
- * @pre  ctx->fc_mach is in S_TERMINAL or S_FAILURE state.
+ * @pre  C2_IN(ctx->fc_mach, (S_TERMINAL, S_FAILURE))
  */
 struct c2_conf_obj *c2_confc_ctx_handout(struct c2_confc_ctx *ctx);
 
-- 
1.8.3.2

