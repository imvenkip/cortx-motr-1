From c5b1a2b49b554ad39e7b97477944d696ee9bfc23 Mon Sep 17 00:00:00 2001
From: "Valery V. Vorotyntsev" <valery_vorotyntsev@xyratex.com>
Date: Mon, 5 Mar 2012 00:34:40 +0200
Subject: [PATCH 038/311] map.h: "objid-to-address" mapping

---
 conf/map.h | 79 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 79 insertions(+)
 create mode 100644 conf/map.h

diff --git a/conf/map.h b/conf/map.h
new file mode 100644
index 0000000..d45efd4
--- /dev/null
+++ b/conf/map.h
@@ -0,0 +1,79 @@
+/* -*- c -*- */
+/*
+ * COPYRIGHT 2012 XYRATEX TECHNOLOGY LIMITED
+ *
+ * THIS DRAWING/DOCUMENT, ITS SPECIFICATIONS, AND THE DATA CONTAINED
+ * HEREIN, ARE THE EXCLUSIVE PROPERTY OF XYRATEX TECHNOLOGY
+ * LIMITED, ISSUED IN STRICT CONFIDENCE AND SHALL NOT, WITHOUT
+ * THE PRIOR WRITTEN PERMISSION OF XYRATEX TECHNOLOGY LIMITED,
+ * BE REPRODUCED, COPIED, OR DISCLOSED TO A THIRD PARTY, OR
+ * USED FOR ANY PURPOSE WHATSOEVER, OR STORED IN A RETRIEVAL SYSTEM
+ * EXCEPT AS ALLOWED BY THE TERMS OF XYRATEX LICENSES AND AGREEMENTS.
+ *
+ * YOU SHOULD HAVE RECEIVED A COPY OF XYRATEX'S LICENSE ALONG WITH
+ * THIS RELEASE. IF NOT PLEASE CONTACT A XYRATEX REPRESENTATIVE
+ * http://www.xyratex.com/contact
+ *
+ * Original author: Valery V. Vorotyntsev <valery_vorotyntsev@xyratex.com>
+ * Original creation date: 04-Mar-2012
+ */
+#ifndef __COLIBRI_CONF_MAP_H__
+#define __COLIBRI_CONF_MAP_H__
+
+/**
+ * Objid-to-address mapping.
+ *
+ * Maps configuration object identity to the address of this object in
+ * memory.  (Identity of a configuration object is {key, type} pair.)
+ *
+ * c2_conf_map is used as a registry of cached configuration objects.
+ */
+struct c2_conf_map {
+	XXX;
+};
+
+void c2_conf_map_init(struct c2_conf_map *map);
+void c2_conf_map_fini(struct c2_conf_map *map);
+
+/**
+ * Adds new entry to the "objid-to-address" mapping.
+ *
+ * @pre  The mapping does not contain given object.
+ */
+int c2_conf_map_add(struct c2_conf_map *map, const struct c2_conf_obj *obj);
+
+/**
+ * Searches mapping for an object with given key and type.
+ *
+ * Returns NULL if the object is not found.
+ */
+struct c2_conf_obj * c2_conf_map_lookup(const struct c2_conf_map *map,
+					const struct c2_conf_buf *key,
+					enum c2_conf_objtype type);
+
+/**
+ * Mapping cursor.
+ *
+ * c2_conf_map_cursor is used to iterate over elements of a mapping.
+ */
+struct c2_conf_map_cursor {
+	const struct c2_conf_map *mc_map;
+	XXX;
+};
+
+/**
+ * Initialises a cursor, positioning it at the first element of the
+ * mapping.
+ */
+void c2_conf_map_cursor_init(struct c2_conf_map_cursor *cur,
+			     const struct c2_conf_map *map);
+
+void c2_conf_map_cursor_fini(struct c2_conf_map_cursor *cur);
+
+/**
+ * Returns the next element of a mapping. Returns NULL if there are no
+ * more elements.
+ */
+struct c2_conf_obj * c2_conf_map_next(struct c2_conf_map_cursor *cur);
+
+#endif /* __COLIBRI_CONF_MAP_H__ */
-- 
1.8.3.2

