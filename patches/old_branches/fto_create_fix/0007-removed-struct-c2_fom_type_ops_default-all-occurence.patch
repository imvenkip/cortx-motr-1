From 0a2063097f6f2d13e289c868841f4750a6096f01 Mon Sep 17 00:00:00 2001
From: Maxim Medved <Max_Medved@xyratex.com>
Date: Thu, 22 Mar 2012 18:09:49 +0200
Subject: [PATCH 7/9] removed struct c2_fom_type_ops_default, all occurences
 changed to NULL

---
 fop/fop_format.c    | 11 -----------
 fop/fop_format.h    |  3 +--
 ioservice/io_fops.c | 10 ++++------
 3 files changed, 5 insertions(+), 19 deletions(-)

diff --git a/fop/fop_format.c b/fop/fop_format.c
index c623218..f11d33d 100644
--- a/fop/fop_format.c
+++ b/fop/fop_format.c
@@ -39,17 +39,6 @@ static struct c2_fop_decorator *decorators[C2_FOP_DECORATOR_MAX];
 static size_t decorators_nr = 0;
 static bool decoration_used = false;
 
-static int c2_fom_create_dummy(struct c2_fop *fop, struct c2_fom **fom)
-{
-	*fom = NULL;
-	return 0;
-}
-
-/** Default fom type ops */
-const struct c2_fom_type_ops c2_fom_type_ops_default = {
-	.fto_create = c2_fom_create_dummy
-};
-
 void c2_fop_field_type_unprepare(struct c2_fop_field_type *ftype)
 {
 	int    i;
diff --git a/fop/fop_format.h b/fop/fop_format.h
index 701e4ca..9382bbb 100644
--- a/fop/fop_format.h
+++ b/fop/fop_format.h
@@ -80,7 +80,6 @@
 #endif
 
 extern const struct c2_rpc_item_type_ops c2_rpc_fop_default_item_type_ops;
-extern const struct c2_fom_type_ops	 c2_fom_type_ops_default;
 
 struct c2_fop_memlayout;
 
@@ -224,7 +223,7 @@ struct c2_fop_type fopt ## _fopt = {					\
 #define C2_FOP_TYPE_DECLARE(fopt, name, ops, opcode, itflags)		\
         C2_FOP_TYPE_DECLARE_OPS(fopt, name, ops, opcode, itflags,	\
 				&c2_rpc_fop_default_item_type_ops,	\
-				&c2_fom_type_ops_default)
+				NULL)
 
 /** @} end of fop group */
 
diff --git a/ioservice/io_fops.c b/ioservice/io_fops.c
index 1cfe138..7e87ffa 100644
--- a/ioservice/io_fops.c
+++ b/ioservice/io_fops.c
@@ -512,7 +512,7 @@ C2_FOP_TYPE_DECLARE_OPS(c2_fop_cob_readv, "Read request", &c2_io_cob_readv_ops,
 #ifndef __KERNEL__
 			&c2_io_cob_rwv_type_ops);
 #else
-			&c2_fom_type_ops_default);
+			NULL);
 #endif
 C2_FOP_TYPE_DECLARE_OPS(c2_fop_cob_writev, "Write request",
 			&c2_io_cob_writev_ops,
@@ -521,7 +521,7 @@ C2_FOP_TYPE_DECLARE_OPS(c2_fop_cob_writev, "Write request",
 #ifndef __KERNEL__
 			&c2_io_cob_rwv_type_ops);
 #else
-			&c2_fom_type_ops_default);
+			NULL);
 #endif
 
 /**
@@ -529,12 +529,10 @@ C2_FOP_TYPE_DECLARE_OPS(c2_fop_cob_writev, "Write request",
  */
 C2_FOP_TYPE_DECLARE_OPS(c2_fop_cob_writev_rep, "Write reply",
 			&c2_io_rwv_rep_ops, C2_IOSERVICE_WRITEV_REP_OPCODE,
-			C2_RPC_ITEM_TYPE_REPLY, &rpc_item_iov_type_ops,
-			&c2_fom_type_ops_default);
+			C2_RPC_ITEM_TYPE_REPLY, &rpc_item_iov_type_ops, NULL);
 C2_FOP_TYPE_DECLARE_OPS(c2_fop_cob_readv_rep, "Read reply",
 			&c2_io_rwv_rep_ops, C2_IOSERVICE_READV_REP_OPCODE,
-			C2_RPC_ITEM_TYPE_REPLY,  &rpc_item_iov_type_ops,
-			&c2_fom_type_ops_default);
+			C2_RPC_ITEM_TYPE_REPLY,  &rpc_item_iov_type_ops, NULL);
 
 static struct c2_fop_type_format *ioservice_fmts[] = {
 	&c2_fop_file_fid_tfmt,
-- 
1.8.3.2

