#!/usr/bin/env bash

#
# This script compares two xcode protocol files specified by ARGS
#

set -e

M0_SRC_DIR=`readlink -f $0`
M0_SRC_DIR=${M0_SRC_DIR%/*/*}

. $M0_SRC_DIR/utils/functions # report_and_exit

cd $M0_SRC_DIR

diff_cmd='diff -u'
if which wdiff 2>/dev/null ; then
    diff_cmd='wdiff'
fi

proto_current="$M0_SRC_DIR/xcode/protocol.txt"
proto_master="/tmp/protocol-master.txt"

echo "Downloading latest protocol file from master"
wget -O "$proto_master" \
     '10.230.45.149:8080/job/mero-test-master/lastSuccessfulBuild/artifact/artifacts/protocol.txt'

echo "Comparing '$proto_master' and '$proto_current' files"
$diff_cmd $proto_master $proto_current

report_and_exit initscripts $?
