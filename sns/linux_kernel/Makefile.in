OS = @OS@
SNS_SRCDIR = @SRCDIR@/sns/linux_kernel
GALOIS_SRCDIR = @SRCDIR@/../galois

ifeq ($(OS),linux)

obj-m       := ksns.o
shared_src  := ls_solve.c matvec.c parity_math.c
kernel_src  := ksns.c
ksns-y      := $(shared_src:.c=.o) $(kernel_src:.c=.o)
orig        := 	../ls_solve.c ../ls_solve.h ../matvec.c ../matvec.h  \
		../parity_math.c ../parity_math.h ../parity_ops.h \
		$(GALOIS_SRCDIR)/galois.h


EXTRA_CFLAGS = -DHAVE_CONFIG_H -I@SRCDIR@ @KCFLAGS@

prepare:
	ln -fs $(orig) .

clean distclean:
	$(RM) $(shared_src) Module.markers Module.symvers modules.order
	$(MAKE) -C @LINUX_OBJ@ M=`pwd` clean

else

all:
install:
uninstall:
distclean clean:

endif

distdir:
	cp $(SNS_SRCDIR)/Makefile.in \
           @top_builddir@/@PACKAGE@-@VERSION@/sns/linux_kernel
