PING_SRCDIR  = @SRCDIR@/rpc/it/linux_kernel
PINGDIR      = @SRCDIR@/rpc/it
FOPDIR       = @SRCDIR@/fop
XCODE_DIR    = @SRCDIR@/xcode

obj-m       := krpcping.o
shared_src  := rpc_ping.c ping_fop.c ping_fop_xc.c ping_fom.c xcode.c
kernel_src  := rpcping_kernel.c
krpcping-y  := $(shared_src:.c=.o) $(kernel_src:.c=.o)
headers     := ping_fop_xc.h
orig        := $(shared_src:%=../%) $(headers:%=../%) $(XCODE_DIR)/xcode.c

EXTRA_CFLAGS = -DHAVE_CONFIG_H -iquote @SRCDIR@ @KCFLAGS@

prepare:
	ln -fs $(orig) .

clean distclean:
	$(RM) ping_fop_xc.[ch] xcode.c
	$(RM) $(shared_src) Module.markers Module.symvers modules.order
	$(MAKE) -C @LINUX_OBJ@ M=`pwd` clean

distdir:
	cp $(PING_SRCDIR)/Makefile.in  $(PING_SRCDIR)/rpcping_kernel.c $(PING_SRCDIR)/rpc_ping.h\
           @top_builddir@/@PACKAGE@-@VERSION@/rpc/it/linux_kernel
