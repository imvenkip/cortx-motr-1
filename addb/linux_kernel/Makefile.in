ADDB_SRCDIR = @SRCDIR@/addb/linux_kernel
FOPDIR = @SRCDIR@/fop
ADDBDIR = @SRCDIR@/addb

GCOV_PROFILE := @K_ENABLE_COVERAGE@

obj-y       := kaddb.o
shared_src  := addb.c addb_fop.c
kernel_src  := addb_console.c addb_k.c
kaddb-y     := $(shared_src:.c=.o) $(kernel_src:.c=.o)
orig        := $(shared_src:%=../%)

EXTRA_CFLAGS = -DHAVE_CONFIG_H -I@SRCDIR@ @KCFLAGS@

prepare: addb_k.c addb_k.h
	ln -fs $(orig) .

addb_k.c addb_k.h: $(ADDBDIR)/addb.ff
	$(FOPDIR)/fop2c -k $(ADDBDIR)/addb.ff

install modules_install:
	$(MAKE) INSTALL_MOD_DIR=kernel/fs/addb -C @LINUX_OBJ@ M=`pwd` modules_install

uninstall:
	rm -fr @LUNUX_MOD@/kernel/fs/addb

clean distclean:
	$(RM) addb_k.[ch]
	$(RM) $(shared_src) Module.markers Module.symvers modules.order
	$(MAKE) -C @LINUX_OBJ@ M=`pwd` clean

distdir:
	cp $(ADDB_SRCDIR)/Makefile.in $(ADDB_SRCDIR)/addb_console.c \
@top_builddir@/@PACKAGE@-@VERSION@/addb/linux_kernel
