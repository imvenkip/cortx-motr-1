OS = @OS@
LIB_SRCDIR = @SRCDIR@/lib/linux_kernel

ifeq ($(OS),linux)

obj-m       := klibc2.o
shared_src  := vec.c list.c queue.c
kernel_src  := memory.c mutex.c
klibc2-y    := $(shared_src:.c=.o) $(kernel_src:.c=.o)
orig        := $(shared_src:%=../%)

EXTRA_CFLAGS = -DHAVE_CONFIG_H -I@SRCDIR@ @KCFLAGS@

prepare:
	ln -fs $(orig) .

clean distclean:
	$(RM) $(shared_src) Module.markers Module.symvers modules.order
	$(MAKE) -C @LINUX_OBJ@ M=`pwd` clean

else

all:
install:
uninstall:
distclean clean:

endif

distdir:
	cp $(LIB_SRCDIR)/Makefile.in \
	$(LIB_SRCDIR)/memory.c $(LIB_SRCDIR)/mutex.c \
	$(LIB_SRCDIR)/assert.h $(LIB_SRCDIR)/cdefs.h \
	$(LIB_SRCDIR)/mutex.h $(LIB_SRCDIR)/types.h \
@top_builddir@/@PACKAGE@-@VERSION@/lib/linux_kernel
