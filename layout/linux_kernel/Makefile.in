LAYOUT_SRCDIR = @SRCDIR@/layout/linux_kernel

GCOV_PROFILE := @K_ENABLE_COVERAGE@

obj-y       := klayout.o
shared_src  := layout.c pdclust.c composite.c list_enum.c linear_enum.c layout_db.c
kernel_src  := klayout.c
klayout-y   := $(shared_src:.c=.o) $(kernel_src:.c=.o)
orig        := $(shared_src:%=../%)

EXTRA_CFLAGS = -DHAVE_CONFIG_H -I@SRCDIR@ @KCFLAGS@

prepare:
	ln -fs $(orig) .

clean distclean:
	$(RM) $(shared_src) Module.markers Module.symvers modules.order
	$(MAKE) -C @LINUX_OBJ@ M=`pwd` clean

distdir:
	cp $(LAYOUT_SRCDIR)/Makefile.in \
           @top_builddir@/@PACKAGE@-@VERSION@/layout/linux_kernel
